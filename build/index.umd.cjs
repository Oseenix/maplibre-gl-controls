(function(T,$){typeof exports=="object"&&typeof module<"u"?$(exports):typeof define=="function"&&define.amd?define(["exports"],$):(T=typeof globalThis<"u"?globalThis:T||self,$(T.MapLibreControls={}))})(this,function(T){"use strict";var di=Object.defineProperty;var yi=(T,$,Q)=>$ in T?di(T,$,{enumerable:!0,configurable:!0,writable:!0,value:Q}):T[$]=Q;var g=(T,$,Q)=>yi(T,typeof $!="symbol"?$+"":$,Q);const $='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>pause</title><path d="M14,19H18V5H14M6,19H10V5H6V19Z" /></svg>',Q='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>play</title><path d="M8,5.14V19.14L19,12.14L8,5.14Z" /></svg>',Nn='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>reload</title><path d="M2 12C2 16.97 6.03 21 11 21C13.39 21 15.68 20.06 17.4 18.4L15.9 16.9C14.63 18.25 12.86 19 11 19C4.76 19 1.64 11.46 6.05 7.05C10.46 2.64 18 5.77 18 12H15L19 16H19.1L23 12H20C20 7.03 15.97 3 11 3C6.03 3 2 7.03 2 12Z" /></svg>',$n='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>skip-backward</title><path d="M20,5V19L13,12M6,5V19H4V5M13,5V19L6,12" /></svg>',Ln='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>skip-forward</title><path d="M4,5V19L11,12M18,5V19H20V5M11,5V19L18,12" /></svg>',vt="rgb(204, 204, 204)",lt=n=>{const t=document.createElement("img");return t.src=`data:image/svg+xml,${encodeURIComponent(n)}`,t.style.width="24px",t.style.height="24px",t};let wt;const An=({length:n,interval:t,onSliderValueChange:e})=>{const r=document.createElement("div");r.classList.add("maplibregl-ctrl"),r.classList.add("maplibregl-ctrl-group"),r.style.width="calc(min((500% - 29px), 260px))",r.style.height="84px",r.style.backgroundColor="rgba(0, 36, 71, 0.8)",r.style.textAlign="center";const i=document.createElement("div");i.innerHTML="<br />",i.style.marginTop="4px",r.appendChild(i);const s=document.createElement("input");s.type="range",s.value="0",s.min="0",s.max=String(n-1),s.addEventListener("input",()=>{e()}),s.style.width="80%",s.style.margin="4px 0",r.appendChild(s);const o=document.createElement("div");o.style.display="flex",o.style.justifyContent="center",o.style.margin="4px 0 0 0";const a=q=>{u.style.backgroundColor=q?vt:""},l=()=>u.style.backgroundColor===vt,u=document.createElement("button");u.appendChild(lt(Nn)),u.style.border="0",u.style.borderRadius="0",u.style.marginRight="16px",u.style.height="24px",u.style.borderRadius="4px",u.onclick=()=>a(!l()),o.appendChild(u);const c=()=>(s.value=String(Math.max(0,Number(s.value)-1)),e(),Number(s.min)<Number(s.value)),f=()=>{if(u.style.backgroundColor!==""&&Number(s.value)==Number(s.max))for(;c(););else s.value=String(Math.min(Number(s.max),Number(s.value)+1));return e(),Number(s.value)<Number(s.max)},p=document.createElement("button");p.appendChild(lt($n)),p.onclick=c,p.style.border="0",p.style.height="24px",p.style.borderRadius="4px";const d=()=>{wt!==void 0&&(clearInterval(wt),wt=void 0,y.onclick=null,S.style.backgroundColor="")},y=document.createElement("button");y.appendChild(lt($)),y.style.border="0",y.style.height="24px",y.style.borderRadius="4px",y.onclick=d;const w=()=>S.style.backgroundColor===vt,x=()=>{w()||(S.style.backgroundColor=vt,wt=setInterval(()=>{f()},t))},S=document.createElement("button");S.appendChild(lt(Q)),S.style.border="0",S.style.height="24px",S.style.borderRadius="4px",S.onclick=x;const P=document.createElement("button");return P.appendChild(lt(Ln)),P.style.border="0",P.style.height="24px",P.style.borderRadius="4px",P.onclick=f,o.appendChild(p),o.appendChild(y),o.appendChild(S),o.appendChild(P),r.appendChild(o),{container:r,titleDiv:i,slider:s,increment:f,decrement:c,isPlaying:w,play:x,pause:d,isLoopEnabled:l,setLoopEnabled:a}};class Dn{constructor(t,e={}){g(this,"map");g(this,"options");g(this,"container");g(this,"containerTitle");g(this,"temporalSlider");g(this,"temporalFrames");g(this,"next");g(this,"prev");g(this,"play");g(this,"pause");g(this,"isPlaying");g(this,"isLoopEnabled");g(this,"setLoopEnabled");g(this,"goto");this.temporalFrames=t,this.options=e;const r={length:this.temporalFrames.length,interval:this.options.interval||500,onSliderValueChange:()=>this.refresh()},{container:i,titleDiv:s,slider:o,increment:a,decrement:l,play:u,pause:c,isPlaying:f,isLoopEnabled:p,setLoopEnabled:d}=An(r);this.container=i,this.containerTitle=s,this.temporalSlider=o,this.next=a,this.prev=l,this.play=u,this.pause=c,this.isPlaying=f,this.isLoopEnabled=p,this.setLoopEnabled=d,this.goto=y=>{o.value=String(Math.min(this.temporalFrames.length-1,Math.max(0,y))),this.refresh()}}onAdd(t){return this.map=t,t.getContainer().appendChild(this.container),this.map.once("styledata",()=>{this.refresh()}),this.container}onRemove(){var t;(t=this.container.parentNode)==null||t.removeChild(this.container),this.map=void 0}getPosition(){return"bottom-left"}refresh(){const t=Number(this.temporalSlider.value);this.containerTitle.innerHTML=this.temporalFrames[t].title;const e=this.temporalFrames[t].layers.map(r=>r.id);this.temporalFrames.forEach(r=>{r.layers.forEach(i=>this.setVisible(i,e.includes(i.id)))})}setVisible(t,e=!0){var r,i,s,o;if(t.type==="raster"||t.type==="fill"||t.type==="circle"||t.type==="line"){t.type==="raster"&&((r=this.map)==null||r.setPaintProperty(t.id,`${t.type}-opacity-transition`,{duration:0}));let a;e?a=((i=t.paint)==null?void 0:i[`${t.type}-opacity`])||1:a=this.options.performance?1e-21:0,(s=this.map)==null||s.setPaintProperty(t.id,`${t.type}-opacity`,a)}else(o=this.map)==null||o.setLayoutProperty(t.id,"visibility",e?"visible":"none")}}function Le(n,...t){for(const e of t)for(const r in e)n[r]=e[r];return n}class j extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class Gt{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[r,i]of e)this.bindings[r]=i}concat(t){return new Gt(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return this.bindings[t]?!0:this.parent?this.parent.has(t):!1}}const Ct={kind:"null"},h={kind:"number"},v={kind:"string"},m={kind:"boolean"},O={kind:"color"},kt={kind:"projectionDefinition"},K={kind:"object"},b={kind:"value"},Fn={kind:"error"},Mt={kind:"collator"},Et={kind:"formatted"},It={kind:"padding"},ut={kind:"resolvedImage"},xt={kind:"variableAnchorOffsetCollection"};function L(n,t){return{kind:"array",itemType:n,N:t}}function k(n){if(n.kind==="array"){const t=k(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}else return n.kind}const zn=[Ct,h,v,m,O,kt,Et,K,L(b),It,ut,xt];function ct(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ct(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const e of zn)if(!ct(e,t))return null}}return`Expected ${k(n)} but found ${k(t)} instead.`}function Xt(n,t){return t.some(e=>e.kind===n.kind)}function G(n,t){return t.some(e=>e==="null"?n===null:e==="array"?Array.isArray(n):e==="object"?n&&!Array.isArray(n)&&typeof n=="object":e===typeof n)}function tt(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const Ae=.96422,De=1,Fe=.82521,ze=4/29,et=6/29,Be=3*et*et,Bn=et*et*et,jn=Math.PI/180,On=180/Math.PI;function je(n){return n=n%360,n<0&&(n+=360),n}function Oe([n,t,e,r]){n=Zt(n),t=Zt(t),e=Zt(e);let i,s;const o=Jt((.2225045*n+.7168786*t+.0606169*e)/De);n===t&&t===e?i=s=o:(i=Jt((.4360747*n+.3850649*t+.1430804*e)/Ae),s=Jt((.0139322*n+.0971045*t+.7141733*e)/Fe));const a=116*o-16;return[a<0?0:a,500*(i-o),200*(o-s),r]}function Zt(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Jt(n){return n>Bn?Math.pow(n,1/3):n/Be+ze}function Re([n,t,e,r]){let i=(n+16)/116,s=isNaN(t)?i:i+t/500,o=isNaN(e)?i:i-e/200;return i=De*Qt(i),s=Ae*Qt(s),o=Fe*Qt(o),[Yt(3.1338561*s-1.6168667*i-.4906146*o),Yt(-.9787684*s+1.9161415*i+.033454*o),Yt(.0719453*s-.2289914*i+1.4052427*o),r]}function Yt(n){return n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055,n<0?0:n>1?1:n}function Qt(n){return n>et?n*n*n:Be*(n-ze)}function Rn(n){const[t,e,r,i]=Oe(n),s=Math.sqrt(e*e+r*r);return[Math.round(s*1e4)?je(Math.atan2(r,e)*On):NaN,s,t,i]}function _n([n,t,e,r]){return n=isNaN(n)?0:n*jn,Re([e,Math.cos(n)*t,Math.sin(n)*t,r])}function Hn([n,t,e,r]){n=je(n),t/=100,e/=100;function i(s){const o=(s+n/30)%12,a=t*Math.min(e,1-e);return e-a*Math.max(-1,Math.min(o-3,9-o,1))}return[i(0),i(8),i(4),r]}function Un(n){if(n=n.toLowerCase().trim(),n==="transparent")return[0,0,0,0];const t=qn[n];if(t){const[i,s,o]=t;return[i/255,s/255,o/255,1]}if(n.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(n)){const s=n.length<6?1:2;let o=1;return[Tt(n.slice(o,o+=s)),Tt(n.slice(o,o+=s)),Tt(n.slice(o,o+=s)),Tt(n.slice(o,o+s)||"ff")]}if(n.startsWith("rgb")){const i=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,s=n.match(i);if(s){const[o,a,l,u,c,f,p,d,y,w,x,S]=s,P=[u||" ",p||" ",w].join("");if(P==="  "||P==="  /"||P===",,"||P===",,,"){const q=[l,f,y].join(""),Wt=q==="%%%"?100:q===""?255:0;if(Wt){const Sn=[nt(+a/Wt,0,1),nt(+c/Wt,0,1),nt(+d/Wt,0,1),x?_e(+x,S):1];if(He(Sn))return Sn}}return}}const e=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,r=n.match(e);if(r){const[i,s,o,a,l,u,c,f,p]=r,d=[o||" ",l||" ",c].join("");if(d==="  "||d==="  /"||d===",,"||d===",,,"){const y=[+s,nt(+a,0,100),nt(+u,0,100),f?_e(+f,p):1];if(He(y))return Hn(y)}}}function Tt(n){return parseInt(n.padEnd(2,n),16)/255}function _e(n,t){return nt(t?n/100:n,0,1)}function nt(n,t,e){return Math.min(Math.max(t,n),e)}function He(n){return!n.some(Number.isNaN)}const qn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function V(n,t,e){return n+e*(t-n)}function ft(n,t,e){return n.map((r,i)=>V(r,t[i],e))}function Vn(n){return n==="rgb"||n==="hcl"||n==="lab"}class C{constructor(t,e,r,i=1,s=!0){this.r=t,this.g=e,this.b=r,this.a=i,s||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[t,e,r,i]))}static parse(t){if(t instanceof C)return t;if(typeof t!="string")return;const e=Un(t);if(e)return new C(...e,!1)}get rgb(){const{r:t,g:e,b:r,a:i}=this,s=i||1/0;return this.overwriteGetter("rgb",[t/s,e/s,r/s,i])}get hcl(){return this.overwriteGetter("hcl",Rn(this.rgb))}get lab(){return this.overwriteGetter("lab",Oe(this.rgb))}overwriteGetter(t,e){return Object.defineProperty(this,t,{value:e}),e}toString(){const[t,e,r,i]=this.rgb;return`rgba(${[t,e,r].map(s=>Math.round(s*255)).join(",")},${i})`}static interpolate(t,e,r,i="rgb"){switch(i){case"rgb":{const[s,o,a,l]=ft(t.rgb,e.rgb,r);return new C(s,o,a,l,!1)}case"hcl":{const[s,o,a,l]=t.hcl,[u,c,f,p]=e.hcl;let d,y;if(!isNaN(s)&&!isNaN(u)){let q=u-s;u>s&&q>180?q-=360:u<s&&s-u>180&&(q+=360),d=s+r*q}else isNaN(s)?isNaN(u)?d=NaN:(d=u,(a===1||a===0)&&(y=c)):(d=s,(f===1||f===0)&&(y=o));const[w,x,S,P]=_n([d,y??V(o,c,r),V(a,f,r),V(l,p,r)]);return new C(w,x,S,P,!1)}case"lab":{const[s,o,a,l]=Re(ft(t.lab,e.lab,r));return new C(s,o,a,l,!1)}}}}C.black=new C(0,0,0,1),C.white=new C(1,1,1,1),C.transparent=new C(0,0,0,0),C.red=new C(1,0,0,1);class Kt{constructor(t,e,r){t?this.sensitivity=e?"variant":"case":this.sensitivity=e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class te{constructor(t,e,r,i,s){this.text=t,this.image=e,this.scale=r,this.fontStack=i,this.textColor=s}}class R{constructor(t){this.sections=t}static fromString(t){return new R([new te(t,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof R?t:R.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class N{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof N)return t;if(typeof t=="number")return new N([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const e of t)if(typeof e!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]];break}return new N(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,r){return new N(ft(t.values,e.values,r))}}class E{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Wn=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class A{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof A)return t;if(!(!Array.isArray(t)||t.length<1||t.length%2!==0)){for(let e=0;e<t.length;e+=2){const r=t[e],i=t[e+1];if(typeof r!="string"||!Wn.has(r)||!Array.isArray(i)||i.length!==2||typeof i[0]!="number"||typeof i[1]!="number")return}return new A(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,r){const i=t.values,s=e.values;if(i.length!==s.length)throw new E(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${e.toString()}`);const o=[];for(let a=0;a<i.length;a+=2){if(i[a]!==s[a])throw new E(`Cannot interpolate values containing mismatched anchors. from[${a}]: ${i[a]}, to[${a}]: ${s[a]}`);o.push(i[a]);const[l,u]=i[a+1],[c,f]=s[a+1];o.push([V(l,c,r),V(u,f,r)])}return new A(o)}}class H{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new H({name:t,available:!1}):null}}class D{constructor(t,e,r){this.from=t,this.to=e,this.transition=r}static interpolate(t,e,r){return new D(t,e,r)}static parse(t){if(t instanceof D)return t;if(Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number")return new D(t[0],t[1],t[2]);if(typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number")return new D(t.from,t.to,t.transition);if(typeof t=="string")return new D(t,t,1)}}function Ue(n,t,e,r){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255?typeof r>"u"||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[n,t,e,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[n,t,e,r]:[n,t,e]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ht(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof D||n instanceof C||n instanceof Kt||n instanceof R||n instanceof N||n instanceof A||n instanceof H)return!0;if(Array.isArray(n)){for(const t of n)if(!ht(t))return!1;return!0}else if(typeof n=="object"){for(const t in n)if(!ht(n[t]))return!1;return!0}else return!1}function I(n){if(n===null)return Ct;if(typeof n=="string")return v;if(typeof n=="boolean")return m;if(typeof n=="number")return h;if(n instanceof C)return O;if(n instanceof D)return kt;if(n instanceof Kt)return Mt;if(n instanceof R)return Et;if(n instanceof N)return It;if(n instanceof A)return xt;if(n instanceof H)return ut;if(Array.isArray(n)){const t=n.length;let e;for(const r of n){const i=I(r);if(!e)e=i;else{if(e===i)continue;e=b;break}}return L(e||b,t)}else return K}function pt(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof C||n instanceof D||n instanceof R||n instanceof N||n instanceof A||n instanceof H?n.toString():JSON.stringify(n)}class rt{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(t.length!==2)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ht(t[1]))return e.error("invalid value");const r=t[1];let i=I(r);const s=e.expectedType;return i.kind==="array"&&i.N===0&&s&&s.kind==="array"&&(typeof s.N!="number"||s.N===0)&&(i=s),new rt(i,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const St={string:v,number:h,boolean:m,object:K};class z{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let r=1,i;const s=t[0];if(s==="array"){let a;if(t.length>2){const u=t[1];if(typeof u!="string"||!(u in St)||u==="object")return e.error('The item type argument of "array" must be one of string, number, boolean',1);a=St[u],r++}else a=b;let l;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);l=t[2],r++}i=L(a,l)}else{if(!St[s])throw new Error(`Types doesn't contain name = ${s}`);i=St[s]}const o=[];for(;r<t.length;r++){const a=e.parse(t[r],r,b);if(!a)return null;o.push(a)}return new z(i,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const r=this.args[e].evaluate(t);if(ct(this.type,I(r))){if(e===this.args.length-1)throw new E(`Expected value to be of type ${k(this.type)}, but found ${k(I(r))} instead.`)}else return r}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const qe={"to-boolean":m,"to-color":O,"to-number":h,"to-string":v};class W{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const r=t[0];if(!qe[r])throw new Error(`Can't parse ${r} as it is not part of the known types`);if((r==="to-boolean"||r==="to-string")&&t.length!==2)return e.error("Expected one argument.");const i=qe[r],s=[];for(let o=1;o<t.length;o++){const a=e.parse(t[o],o,b);if(!a)return null;s.push(a)}return new W(i,s)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let e,r;for(const i of this.args){if(e=i.evaluate(t),r=null,e instanceof C)return e;if(typeof e=="string"){const s=t.parseColor(e);if(s)return s}else if(Array.isArray(e)&&(e.length<3||e.length>4?r=`Invalid rgba value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:r=Ue(e[0],e[1],e[2],e[3]),!r))return new C(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new E(r||`Could not parse color from value '${typeof e=="string"?e:JSON.stringify(e)}'`)}case"padding":{let e;for(const r of this.args){e=r.evaluate(t);const i=N.parse(e);if(i)return i}throw new E(`Could not parse padding from value '${typeof e=="string"?e:JSON.stringify(e)}'`)}case"variableAnchorOffsetCollection":{let e;for(const r of this.args){e=r.evaluate(t);const i=A.parse(e);if(i)return i}throw new E(`Could not parse variableAnchorOffsetCollection from value '${typeof e=="string"?e:JSON.stringify(e)}'`)}case"number":{let e=null;for(const r of this.args){if(e=r.evaluate(t),e===null)return 0;const i=Number(e);if(!isNaN(i))return i}throw new E(`Could not convert ${JSON.stringify(e)} to number.`)}case"formatted":return R.fromString(pt(this.args[0].evaluate(t)));case"resolvedImage":return H.fromString(pt(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return pt(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Gn(n,t){if(n.length<=1)return[n];const r=[];let i,s;for(const o of n){const a=Ve(o);a!==0&&(o.area=Math.abs(a),s===void 0&&(s=a<0),s===a<0?(i&&r.push(i),i=[o]):i.push(o))}return i&&r.push(i),r}function Ve(n){let t=0;for(let e=0,r=n.length,i=r-1,s,o;e<r;i=e++)s=n[e],o=n[i],t+=(o.x-s.x)*(s.y+o.y);return t}function Xn(n){const t=n.length;for(let e=0,r;e<t;e++){const i=Ve(n[e]);if(i!==0){if(r===void 0)r=i<0;else if(r===i<0)return!0}}return!1}const We=["Unknown","Point","LineString","Polygon"],Zn={Unknown:"Unknown",Point:"Point",MultiPoint:"Point",LineString:"LineString",MultiLineString:"LineString",Polygon:"Polygon",MultiPolygon:"Polygon"};class Ge{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryDollarType(){return this.feature?typeof this.feature.type=="number"?We[this.feature.type]:Zn[this.feature.type]:null}geometryType(){let t=this.feature.type;if(typeof t!="number"||(t=We[this.feature.type],t==="Unknown"))return t;const e=this.geometry();return e.length===1?t:t!=="Polygon"?`Multi${t}`:Xn(e)?"MultiPolygon":"Polygon"}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=C.parse(t)),e}}class Pt{constructor(t,e,r=[],i,s=new Gt,o=[]){this.registry=t,this.path=r,this.key=r.map(a=>`[${a}]`).join(""),this.scope=s,this.errors=o,this.expectedType=i,this._isConstant=e}parse(t,e,r,i,s={}){return e?this.concat(e,r,i)._parse(t,s):this._parse(t,s)}_parse(t,e){(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number")&&(t=["literal",t]);function r(i,s,o){return o==="assert"?new z(s,[i]):o==="coerce"?new W(s,[i]):i}if(Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=t[0];if(typeof i!="string")return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const s=this.registry[i];if(s){let o=s.parse(t,this);if(!o)return null;if(this.expectedType){const a=this.expectedType,l=o.type;if((a.kind==="string"||a.kind==="number"||a.kind==="boolean"||a.kind==="object"||a.kind==="array")&&l.kind==="value")o=r(o,a,e.typeAnnotation||"assert");else if(a.kind==="projectionDefinition"&&(l.kind==="string"||l.kind==="array"))o=r(o,a,e.typeAnnotation||"coerce");else if((a.kind==="color"||a.kind==="formatted"||a.kind==="resolvedImage")&&(l.kind==="value"||l.kind==="string"))o=r(o,a,e.typeAnnotation||"coerce");else if(a.kind==="padding"&&(l.kind==="value"||l.kind==="number"||l.kind==="array"))o=r(o,a,e.typeAnnotation||"coerce");else if(a.kind==="variableAnchorOffsetCollection"&&(l.kind==="value"||l.kind==="array"))o=r(o,a,e.typeAnnotation||"coerce");else if(this.checkSubtype(a,l))return null}if(!(o instanceof rt)&&o.type.kind!=="resolvedImage"&&this._isConstant(o)){const a=new Ge;try{o=new rt(o.type,o.evaluate(a))}catch(l){return this.error(l.message),null}}return o}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof t>"u"?this.error("'undefined' value invalid. Use null instead."):typeof t=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof t} instead.`)}concat(t,e,r){const i=typeof t=="number"?this.path.concat(t):this.path,s=r?this.scope.concat(r):this.scope;return new Pt(this.registry,this._isConstant,i,e||null,s,this.errors)}error(t,...e){const r=`${this.key}${e.map(i=>`[${i}]`).join("")}`;this.errors.push(new j(r,t))}checkSubtype(t,e){const r=ct(t,e);return r&&this.error(r),r}}class Nt{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const r=[];for(let s=1;s<t.length-1;s+=2){const o=t[s];if(typeof o!="string")return e.error(`Expected string, but found ${typeof o} instead.`,s);if(/[^a-zA-Z0-9_]/.test(o))return e.error("Variable names must contain only alphanumeric characters or '_'.",s);const a=e.parse(t[s+1],s+1);if(!a)return null;r.push([o,a])}const i=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return i?new Nt(r,i):null}outputDefined(){return this.result.outputDefined()}}class $t{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(t.length!==2||typeof t[1]!="string")return e.error("'var' expression requires exactly one string literal argument.");const r=t[1];return e.scope.has(r)?new $t(r,e.scope.get(r)):e.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ee{constructor(t,e,r){this.type=t,this.index=e,this.input=r}static parse(t,e){if(t.length!==3)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,h),i=e.parse(t[2],2,L(e.expectedType||b));if(!r||!i)return null;const s=i.type;return new ee(s.itemType,r,i)}evaluate(t){const e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new E(`Array index out of bounds: ${e} < 0.`);if(e>=r.length)throw new E(`Array index out of bounds: ${e} > ${r.length-1}.`);if(e!==Math.floor(e))throw new E(`Array index must be an integer, but found ${e} instead.`);return r[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class ne{constructor(t,e){this.type=m,this.needle=t,this.haystack=e}static parse(t,e){if(t.length!==3)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,b),i=e.parse(t[2],2,b);return!r||!i?null:Xt(r.type,[m,v,h,Ct,b])?new ne(r,i):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${k(r.type)} instead`)}evaluate(t){const e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!r)return!1;if(!G(e,["boolean","string","number","null"]))throw new E(`Expected first argument to be of type boolean, string, number or null, but found ${k(I(e))} instead.`);if(!G(r,["string","array"]))throw new E(`Expected second argument to be of type array or string, but found ${k(I(r))} instead.`);return r.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Lt{constructor(t,e,r){this.type=h,this.needle=t,this.haystack=e,this.fromIndex=r}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,b),i=e.parse(t[2],2,b);if(!r||!i)return null;if(!Xt(r.type,[m,v,h,Ct,b]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${k(r.type)} instead`);if(t.length===4){const s=e.parse(t[3],3,h);return s?new Lt(r,i,s):null}else return new Lt(r,i)}evaluate(t){const e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!G(e,["boolean","string","number","null"]))throw new E(`Expected first argument to be of type boolean, string, number or null, but found ${k(I(e))} instead.`);let i;if(this.fromIndex&&(i=this.fromIndex.evaluate(t)),G(r,["string"])){const s=r.indexOf(e,i);return s===-1?-1:[...r.slice(0,s)].length}else{if(G(r,["array"]))return r.indexOf(e,i);throw new E(`Expected second argument to be of type array or string, but found ${k(I(r))} instead.`)}}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class re{constructor(t,e,r,i,s,o){this.inputType=t,this.type=e,this.input=r,this.cases=i,this.outputs=s,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!==1)return e.error("Expected an even number of arguments.");let r,i;e.expectedType&&e.expectedType.kind!=="value"&&(i=e.expectedType);const s={},o=[];for(let u=2;u<t.length-1;u+=2){let c=t[u];const f=t[u+1];Array.isArray(c)||(c=[c]);const p=e.concat(u);if(c.length===0)return p.error("Expected at least one branch label.");for(const y of c){if(typeof y!="number"&&typeof y!="string")return p.error("Branch labels must be numbers or strings.");if(typeof y=="number"&&Math.abs(y)>Number.MAX_SAFE_INTEGER)return p.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof y=="number"&&Math.floor(y)!==y)return p.error("Numeric branch labels must be integer values.");if(!r)r=I(y);else if(p.checkSubtype(r,I(y)))return null;if(typeof s[String(y)]<"u")return p.error("Branch labels must be unique.");s[String(y)]=o.length}const d=e.parse(f,u,i);if(!d)return null;i=i||d.type,o.push(d)}const a=e.parse(t[1],1,b);if(!a)return null;const l=e.parse(t[t.length-1],t.length-1,i);return!l||a.type.kind!=="value"&&e.concat(1).checkSubtype(r,a.type)?null:new re(r,i,a,s,o,l)}evaluate(t){const e=this.input.evaluate(t);return(I(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class ie{constructor(t,e,r){this.type=t,this.branches=e,this.otherwise=r}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!==0)return e.error("Expected an odd number of arguments.");let r;e.expectedType&&e.expectedType.kind!=="value"&&(r=e.expectedType);const i=[];for(let o=1;o<t.length-1;o+=2){const a=e.parse(t[o],o,m);if(!a)return null;const l=e.parse(t[o+1],o+1,r);if(!l)return null;i.push([a,l]),r=r||l.type}const s=e.parse(t[t.length-1],t.length-1,r);if(!s)return null;if(!r)throw new Error("Can't infer output type");return new ie(r,i,s)}evaluate(t){for(const[e,r]of this.branches)if(e.evaluate(t))return r.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,r]of this.branches)t(e),t(r);t(this.otherwise)}outputDefined(){return this.branches.every(([t,e])=>e.outputDefined())&&this.otherwise.outputDefined()}}class At{constructor(t,e,r,i){this.type=t,this.input=e,this.beginIndex=r,this.endIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,b),i=e.parse(t[2],2,h);if(!r||!i)return null;if(!Xt(r.type,[L(b),v,b]))return e.error(`Expected first argument to be of type array or string, but found ${k(r.type)} instead`);if(t.length===4){const s=e.parse(t[3],3,h);return s?new At(r.type,r,i,s):null}else return new At(r.type,r,i)}evaluate(t){const e=this.input.evaluate(t),r=this.beginIndex.evaluate(t);let i;if(this.endIndex&&(i=this.endIndex.evaluate(t)),G(e,["string"]))return[...e].slice(r,i).join("");if(G(e,["array"]))return e.slice(r,i);throw new E(`Expected first argument to be of type array or string, but found ${k(I(e))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Dt(n,t){const e=n.length-1;let r=0,i=e,s=0,o,a;for(;r<=i;)if(s=Math.floor((r+i)/2),o=n[s],a=n[s+1],o<=t){if(s===e||t<a)return s;r=s+1}else if(o>t)i=s-1;else throw new E("Input is not a number.");return 0}class Ft{constructor(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[i,s]of r)this.labels.push(i),this.outputs.push(s)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!==0)return e.error("Expected an even number of arguments.");const r=e.parse(t[1],1,h);if(!r)return null;const i=[];let s=null;e.expectedType&&e.expectedType.kind!=="value"&&(s=e.expectedType);for(let o=1;o<t.length;o+=2){const a=o===1?-1/0:t[o],l=t[o+1],u=o,c=o+1;if(typeof a!="number")return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(i.length&&i[i.length-1][0]>=a)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);const f=e.parse(l,c,s);if(!f)return null;s=s||f.type,i.push([a,f])}return new Ft(s,r,i)}evaluate(t){const e=this.labels,r=this.outputs;if(e.length===1)return r[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return r[0].evaluate(t);const s=e.length;if(i>=e[s-1])return r[s-1].evaluate(t);const o=Dt(e,i);return r[o].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Jn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var se,Xe;function Yn(){if(Xe)return se;Xe=1,se=n;function n(t,e,r,i){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=r,this.p2y=i}return n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var r=t,i=0;i<8;i++){var s=this.sampleCurveX(r)-t;if(Math.abs(s)<e)return r;var o=this.sampleCurveDerivativeX(r);if(Math.abs(o)<1e-6)break;r=r-s/o}var a=0,l=1;for(r=t,i=0;i<20&&(s=this.sampleCurveX(r),!(Math.abs(s-t)<e));i++)t>s?a=r:l=r,r=(l-a)*.5+a;return r},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},se}var Qn=Yn(),Kn=Jn(Qn);class F{constructor(t,e,r,i,s){this.type=t,this.operator=e,this.interpolation=r,this.input=i,this.labels=[],this.outputs=[];for(const[o,a]of s)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(t,e,r,i){let s=0;if(t.name==="exponential")s=oe(e,t.base,r,i);else if(t.name==="linear")s=oe(e,1,r,i);else if(t.name==="cubic-bezier"){const o=t.controlPoints;s=new Kn(o[0],o[1],o[2],o[3]).solve(oe(e,1,r,i))}return s}static parse(t,e){let[r,i,s,...o]=t;if(!Array.isArray(i)||i.length===0)return e.error("Expected an interpolation type expression.",1);if(i[0]==="linear")i={name:"linear"};else if(i[0]==="exponential"){const u=i[1];if(typeof u!="number")return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:u}}else if(i[0]==="cubic-bezier"){const u=i.slice(1);if(u.length!==4||u.some(c=>typeof c!="number"||c<0||c>1))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:u}}else return e.error(`Unknown interpolation type ${String(i[0])}`,1,0);if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!==0)return e.error("Expected an even number of arguments.");if(s=e.parse(s,2,h),!s)return null;const a=[];let l=null;r==="interpolate-hcl"||r==="interpolate-lab"?l=O:e.expectedType&&e.expectedType.kind!=="value"&&(l=e.expectedType);for(let u=0;u<o.length;u+=2){const c=o[u],f=o[u+1],p=u+3,d=u+4;if(typeof c!="number")return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(a.length&&a[a.length-1][0]>=c)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',p);const y=e.parse(f,d,l);if(!y)return null;l=l||y.type,a.push([c,y])}return!tt(l,h)&&!tt(l,kt)&&!tt(l,O)&&!tt(l,It)&&!tt(l,xt)&&!tt(l,L(h))?e.error(`Type ${k(l)} is not interpolatable.`):new F(l,r,i,s,a)}evaluate(t){const e=this.labels,r=this.outputs;if(e.length===1)return r[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return r[0].evaluate(t);const s=e.length;if(i>=e[s-1])return r[s-1].evaluate(t);const o=Dt(e,i),a=e[o],l=e[o+1],u=F.interpolationFactor(this.interpolation,i,a,l),c=r[o].evaluate(t),f=r[o+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return V(c,f,u);case"color":return C.interpolate(c,f,u);case"padding":return N.interpolate(c,f,u);case"variableAnchorOffsetCollection":return A.interpolate(c,f,u);case"array":return ft(c,f,u);case"projectionDefinition":return D.interpolate(c,f,u)}case"interpolate-hcl":return C.interpolate(c,f,u,"hcl");case"interpolate-lab":return C.interpolate(c,f,u,"lab")}}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function oe(n,t,e,r){const i=r-e,s=n-e;return i===0?0:t===1?s/i:(Math.pow(t,s)-1)/(Math.pow(t,i)-1)}const tr={color:C.interpolate,number:V,padding:N.interpolate,variableAnchorOffsetCollection:A.interpolate,array:ft};class dt{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let r=null;const i=e.expectedType;i&&i.kind!=="value"&&(r=i);const s=[];for(const a of t.slice(1)){const l=e.parse(a,1+s.length,r,void 0,{typeAnnotation:"omit"});if(!l)return null;r=r||l.type,s.push(l)}if(!r)throw new Error("No output type");return i&&s.some(a=>ct(i,a.type))?new dt(b,s):new dt(r,s)}evaluate(t){let e=null,r=0,i;for(const s of this.args)if(r++,e=s.evaluate(t),e&&e instanceof H&&!e.available&&(i||(i=e.name),e=null,r===this.args.length&&(e=i)),e!==null)break;return e}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Ze(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function er(n,t,e){return t===e}function nr(n,t,e){return t!==e}function rr(n,t,e){return t<e}function ir(n,t,e){return t>e}function sr(n,t,e){return t<=e}function or(n,t,e){return t>=e}function Je(n,t,e,r){return r.compare(t,e)===0}function ar(n,t,e,r){return!Je(n,t,e,r)}function lr(n,t,e,r){return r.compare(t,e)<0}function ur(n,t,e,r){return r.compare(t,e)>0}function cr(n,t,e,r){return r.compare(t,e)<=0}function fr(n,t,e,r){return r.compare(t,e)>=0}function it(n,t,e){const r=n!=="=="&&n!=="!=";return class Pn{constructor(s,o,a){this.type=m,this.lhs=s,this.rhs=o,this.collator=a,this.hasUntypedArgument=s.type.kind==="value"||o.type.kind==="value"}static parse(s,o){if(s.length!==3&&s.length!==4)return o.error("Expected two or three arguments.");const a=s[0];let l=o.parse(s[1],1,b);if(!l)return null;if(!Ze(a,l.type))return o.concat(1).error(`"${a}" comparisons are not supported for type '${k(l.type)}'.`);let u=o.parse(s[2],2,b);if(!u)return null;if(!Ze(a,u.type))return o.concat(2).error(`"${a}" comparisons are not supported for type '${k(u.type)}'.`);if(l.type.kind!==u.type.kind&&l.type.kind!=="value"&&u.type.kind!=="value")return o.error(`Cannot compare types '${k(l.type)}' and '${k(u.type)}'.`);r&&(l.type.kind==="value"&&u.type.kind!=="value"?l=new z(u.type,[l]):l.type.kind!=="value"&&u.type.kind==="value"&&(u=new z(l.type,[u])));let c=null;if(s.length===4){if(l.type.kind!=="string"&&u.type.kind!=="string"&&l.type.kind!=="value"&&u.type.kind!=="value")return o.error("Cannot use collator to compare non-string types.");if(c=o.parse(s[3],3,Mt),!c)return null}return new Pn(l,u,c)}evaluate(s){const o=this.lhs.evaluate(s),a=this.rhs.evaluate(s);if(r&&this.hasUntypedArgument){const l=I(o),u=I(a);if(l.kind!==u.kind||!(l.kind==="string"||l.kind==="number"))throw new E(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${l.kind}, ${u.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const l=I(o),u=I(a);if(l.kind!=="string"||u.kind!=="string")return t(s,o,a)}return this.collator?e(s,o,a,this.collator.evaluate(s)):t(s,o,a)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}}}const hr=it("==",er,Je),pr=it("!=",nr,ar),dr=it("<",rr,lr),yr=it(">",ir,ur),gr=it("<=",sr,cr),mr=it(">=",or,fr);class zt{constructor(t,e,r){this.type=Mt,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(t.length!==2)return e.error("Expected one argument.");const r=t[1];if(typeof r!="object"||Array.isArray(r))return e.error("Collator options argument must be an object.");const i=e.parse(r["case-sensitive"]===void 0?!1:r["case-sensitive"],1,m);if(!i)return null;const s=e.parse(r["diacritic-sensitive"]===void 0?!1:r["diacritic-sensitive"],1,m);if(!s)return null;let o=null;return r.locale&&(o=e.parse(r.locale,1,v),!o)?null:new zt(i,s,o)}evaluate(t){return new Kt(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class ae{constructor(t,e,r,i,s){this.type=v,this.number=t,this.locale=e,this.currency=r,this.minFractionDigits=i,this.maxFractionDigits=s}static parse(t,e){if(t.length!==3)return e.error("Expected two arguments.");const r=e.parse(t[1],1,h);if(!r)return null;const i=t[2];if(typeof i!="object"||Array.isArray(i))return e.error("NumberFormat options argument must be an object.");let s=null;if(i.locale&&(s=e.parse(i.locale,1,v),!s))return null;let o=null;if(i.currency&&(o=e.parse(i.currency,1,v),!o))return null;let a=null;if(i["min-fraction-digits"]&&(a=e.parse(i["min-fraction-digits"],1,h),!a))return null;let l=null;return i["max-fraction-digits"]&&(l=e.parse(i["max-fraction-digits"],1,h),!l)?null:new ae(r,s,o,a,l)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class le{constructor(t){this.type=Et,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const r=t[1];if(!Array.isArray(r)&&typeof r=="object")return e.error("First argument must be an image or text section.");const i=[];let s=!1;for(let o=1;o<=t.length-1;++o){const a=t[o];if(s&&typeof a=="object"&&!Array.isArray(a)){s=!1;let l=null;if(a["font-scale"]&&(l=e.parse(a["font-scale"],1,h),!l))return null;let u=null;if(a["text-font"]&&(u=e.parse(a["text-font"],1,L(v)),!u))return null;let c=null;if(a["text-color"]&&(c=e.parse(a["text-color"],1,O),!c))return null;const f=i[i.length-1];f.scale=l,f.font=u,f.textColor=c}else{const l=e.parse(t[o],1,b);if(!l)return null;const u=l.type.kind;if(u!=="string"&&u!=="value"&&u!=="null"&&u!=="resolvedImage")return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,i.push({content:l,scale:null,font:null,textColor:null})}}return new le(i)}evaluate(t){const e=r=>{const i=r.content.evaluate(t);return I(i)===ut?new te("",i,null,null,null):new te(pt(i),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)};return new R(this.sections.map(e))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}}class ue{constructor(t){this.type=ut,this.input=t}static parse(t,e){if(t.length!==2)return e.error("Expected two arguments.");const r=e.parse(t[1],1,v);return r?new ue(r):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),r=H.fromString(e);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(e)>-1),r}eachChild(t){t(this.input)}outputDefined(){return!1}}class ce{constructor(t){this.type=h,this.input=t}static parse(t,e){if(t.length!==2)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const r=e.parse(t[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?e.error(`Expected argument of type string or array, but found ${k(r.type)} instead.`):new ce(r):null}evaluate(t){const e=this.input.evaluate(t);if(typeof e=="string")return[...e].length;if(Array.isArray(e))return e.length;throw new E(`Expected value to be of type string or array, but found ${k(I(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const _=8192;function br(n,t){const e=vr(n[0]),r=Cr(n[1]),i=Math.pow(2,t.z);return[Math.round(e*i*_),Math.round(r*i*_)]}function fe(n,t){const e=Math.pow(2,t.z),r=(n[0]/_+t.x)/e,i=(n[1]/_+t.y)/e;return[wr(r),kr(i)]}function vr(n){return(180+n)/360}function wr(n){return n*360-180}function Cr(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function kr(n){return 360/Math.PI*Math.atan(Math.exp((180-n*360)*Math.PI/180))-90}function yt(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function gt(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Mr(n,t,e){return t[1]>n[1]!=e[1]>n[1]&&n[0]<(e[0]-t[0])*(n[1]-t[1])/(e[1]-t[1])+t[0]}function Er(n,t,e){const r=n[0]-t[0],i=n[1]-t[1],s=n[0]-e[0],o=n[1]-e[1];return r*o-s*i===0&&r*s<=0&&i*o<=0}function Bt(n,t,e,r){const i=[t[0]-n[0],t[1]-n[1]],s=[r[0]-e[0],r[1]-e[1]];return Sr(s,i)===0?!1:!!(Qe(n,t,e,r)&&Qe(e,r,n,t))}function Ir(n,t,e){for(const r of e)for(let i=0;i<r.length-1;++i)if(Bt(n,t,r[i],r[i+1]))return!0;return!1}function st(n,t,e=!1){let r=!1;for(const i of t)for(let s=0;s<i.length-1;s++){if(Er(n,i[s],i[s+1]))return e;Mr(n,i[s],i[s+1])&&(r=!r)}return r}function xr(n,t){for(const e of t)if(st(n,e))return!0;return!1}function Ye(n,t){for(const e of n)if(!st(e,t))return!1;for(let e=0;e<n.length-1;++e)if(Ir(n[e],n[e+1],t))return!1;return!0}function Tr(n,t){for(const e of t)if(Ye(n,e))return!0;return!1}function Sr(n,t){return n[0]*t[1]-n[1]*t[0]}function Qe(n,t,e,r){const i=n[0]-e[0],s=n[1]-e[1],o=t[0]-e[0],a=t[1]-e[1],l=r[0]-e[0],u=r[1]-e[1],c=i*u-l*s,f=o*u-l*a;return c>0&&f<0||c<0&&f>0}function he(n,t,e){const r=[];for(let i=0;i<n.length;i++){const s=[];for(let o=0;o<n[i].length;o++){const a=br(n[i][o],e);yt(t,a),s.push(a)}r.push(s)}return r}function Ke(n,t,e){const r=[];for(let i=0;i<n.length;i++){const s=he(n[i],t,e);r.push(s)}return r}function tn(n,t,e,r){if(n[0]<e[0]||n[0]>e[2]){const i=r*.5;let s=n[0]-e[0]>i?-r:e[0]-n[0]>i?r:0;s===0&&(s=n[0]-e[2]>i?-r:e[2]-n[0]>i?r:0),n[0]+=s}yt(t,n)}function Pr(n){n[0]=n[1]=1/0,n[2]=n[3]=-1/0}function en(n,t,e,r){const i=Math.pow(2,r.z)*_,s=[r.x*_,r.y*_],o=[];for(const a of n)for(const l of a){const u=[l.x+s[0],l.y+s[1]];tn(u,t,e,i),o.push(u)}return o}function nn(n,t,e,r){const i=Math.pow(2,r.z)*_,s=[r.x*_,r.y*_],o=[];for(const a of n){const l=[];for(const u of a){const c=[u.x+s[0],u.y+s[1]];yt(t,c),l.push(c)}o.push(l)}if(t[2]-t[0]<=i/2){Pr(t);for(const a of o)for(const l of a)tn(l,t,e,i)}return o}function Nr(n,t){const e=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=n.canonicalID();if(t.type==="Polygon"){const s=he(t.coordinates,r,i),o=en(n.geometry(),e,r,i);if(!gt(e,r))return!1;for(const a of o)if(!st(a,s))return!1}if(t.type==="MultiPolygon"){const s=Ke(t.coordinates,r,i),o=en(n.geometry(),e,r,i);if(!gt(e,r))return!1;for(const a of o)if(!xr(a,s))return!1}return!0}function $r(n,t){const e=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=n.canonicalID();if(t.type==="Polygon"){const s=he(t.coordinates,r,i),o=nn(n.geometry(),e,r,i);if(!gt(e,r))return!1;for(const a of o)if(!Ye(a,s))return!1}if(t.type==="MultiPolygon"){const s=Ke(t.coordinates,r,i),o=nn(n.geometry(),e,r,i);if(!gt(e,r))return!1;for(const a of o)if(!Tr(a,s))return!1}return!0}class X{constructor(t,e){this.type=m,this.geojson=t,this.geometries=e}static parse(t,e){if(t.length!==2)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ht(t[1])){const r=t[1];if(r.type==="FeatureCollection"){const i=[];for(const s of r.features){const{type:o,coordinates:a}=s.geometry;o==="Polygon"&&i.push(a),o==="MultiPolygon"&&i.push(...a)}if(i.length){const s={type:"MultiPolygon",coordinates:i};return new X(r,s)}}else if(r.type==="Feature"){const i=r.geometry.type;if(i==="Polygon"||i==="MultiPolygon")return new X(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new X(r,r)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryDollarType()==="Point")return Nr(t,this.geometries);if(t.geometryDollarType()==="LineString")return $r(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class rn{constructor(t=[],e=(r,i)=>r<i?-1:r>i?1:0){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:r}=this,i=e[t];for(;t>0;){const s=t-1>>1,o=e[s];if(r(i,o)>=0)break;e[t]=o,t=s}e[t]=i}_down(t){const{data:e,compare:r}=this,i=this.length>>1,s=e[t];for(;t<i;){let o=(t<<1)+1;const a=o+1;if(a<this.length&&r(e[a],e[o])<0&&(o=a),r(e[o],s)>=0)break;e[t]=e[o],t=o}e[t]=s}}const Lr=6378.137,sn=1/298.257223563,on=sn*(2-sn),an=Math.PI/180;class pe{constructor(t){const e=an*Lr*1e3,r=Math.cos(t*an),i=1/(1-on*(1-r*r)),s=Math.sqrt(i);this.kx=e*s*r,this.ky=e*s*i*(1-on)}distance(t,e){const r=this.wrap(t[0]-e[0])*this.kx,i=(t[1]-e[1])*this.ky;return Math.sqrt(r*r+i*i)}pointOnLine(t,e){let r=1/0,i,s,o,a;for(let l=0;l<t.length-1;l++){let u=t[l][0],c=t[l][1],f=this.wrap(t[l+1][0]-u)*this.kx,p=(t[l+1][1]-c)*this.ky,d=0;(f!==0||p!==0)&&(d=(this.wrap(e[0]-u)*this.kx*f+(e[1]-c)*this.ky*p)/(f*f+p*p),d>1?(u=t[l+1][0],c=t[l+1][1]):d>0&&(u+=f/this.kx*d,c+=p/this.ky*d)),f=this.wrap(e[0]-u)*this.kx,p=(e[1]-c)*this.ky;const y=f*f+p*p;y<r&&(r=y,i=u,s=c,o=l,a=d)}return{point:[i,s],index:o,t:Math.max(0,Math.min(1,a))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}const de=100,ye=50;function ln(n,t){return t[0]-n[0]}function jt(n){return n[1]-n[0]+1}function U(n,t){return n[1]>=n[0]&&n[1]<t}function ge(n,t){if(n[0]>n[1])return[null,null];const e=jt(n);if(t){if(e===2)return[n,null];const i=Math.floor(e/2);return[[n[0],n[0]+i],[n[0]+i,n[1]]]}if(e===1)return[n,null];const r=Math.floor(e/2)-1;return[[n[0],n[0]+r],[n[0]+r+1,n[1]]]}function me(n,t){if(!U(t,n.length))return[1/0,1/0,-1/0,-1/0];const e=[1/0,1/0,-1/0,-1/0];for(let r=t[0];r<=t[1];++r)yt(e,n[r]);return e}function be(n){const t=[1/0,1/0,-1/0,-1/0];for(const e of n)for(const r of e)yt(t,r);return t}function un(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function ve(n,t,e){if(!un(n)||!un(t))return NaN;let r=0,i=0;return n[2]<t[0]&&(r=t[0]-n[2]),n[0]>t[2]&&(r=n[0]-t[2]),n[1]>t[3]&&(i=n[1]-t[3]),n[3]<t[1]&&(i=t[1]-n[3]),e.distance([0,0],[r,i])}function Z(n,t,e){const r=e.pointOnLine(t,n);return e.distance(n,r.point)}function we(n,t,e,r,i){const s=Math.min(Z(n,[e,r],i),Z(t,[e,r],i)),o=Math.min(Z(e,[n,t],i),Z(r,[n,t],i));return Math.min(s,o)}function Ar(n,t,e,r,i){if(!(U(t,n.length)&&U(r,e.length)))return 1/0;let o=1/0;for(let a=t[0];a<t[1];++a){const l=n[a],u=n[a+1];for(let c=r[0];c<r[1];++c){const f=e[c],p=e[c+1];if(Bt(l,u,f,p))return 0;o=Math.min(o,we(l,u,f,p,i))}}return o}function Dr(n,t,e,r,i){if(!(U(t,n.length)&&U(r,e.length)))return NaN;let o=1/0;for(let a=t[0];a<=t[1];++a)for(let l=r[0];l<=r[1];++l)if(o=Math.min(o,i.distance(n[a],e[l])),o===0)return o;return o}function Fr(n,t,e){if(st(n,t,!0))return 0;let r=1/0;for(const i of t){const s=i[0],o=i[i.length-1];if(s!==o&&(r=Math.min(r,Z(n,[o,s],e)),r===0))return r;const a=e.pointOnLine(i,n);if(r=Math.min(r,e.distance(n,a.point)),r===0)return r}return r}function zr(n,t,e,r){if(!U(t,n.length))return NaN;for(let s=t[0];s<=t[1];++s)if(st(n[s],e,!0))return 0;let i=1/0;for(let s=t[0];s<t[1];++s){const o=n[s],a=n[s+1];for(const l of e)for(let u=0,c=l.length,f=c-1;u<c;f=u++){const p=l[f],d=l[u];if(Bt(o,a,p,d))return 0;i=Math.min(i,we(o,a,p,d,r))}}return i}function cn(n,t){for(const e of n)for(const r of e)if(st(r,t,!0))return!0;return!1}function Br(n,t,e,r=1/0){const i=be(n),s=be(t);if(r!==1/0&&ve(i,s,e)>=r)return r;if(gt(i,s)){if(cn(n,t))return 0}else if(cn(t,n))return 0;let o=1/0;for(const a of n)for(let l=0,u=a.length,c=u-1;l<u;c=l++){const f=a[c],p=a[l];for(const d of t)for(let y=0,w=d.length,x=w-1;y<w;x=y++){const S=d[x],P=d[y];if(Bt(f,p,S,P))return 0;o=Math.min(o,we(f,p,S,P,e))}}return o}function fn(n,t,e,r,i,s){if(!s)return;const o=ve(me(r,s),i,e);o<t&&n.push([o,s,[0,0]])}function Ot(n,t,e,r,i,s,o){if(!s||!o)return;const a=ve(me(r,s),me(i,o),e);a<t&&n.push([a,s,o])}function Rt(n,t,e,r,i=1/0){let s=Math.min(r.distance(n[0],e[0][0]),i);if(s===0)return s;const o=new rn([[0,[0,n.length-1],[0,0]]],ln),a=be(e);for(;o.length>0;){const l=o.pop();if(l[0]>=s)continue;const u=l[1],c=t?ye:de;if(jt(u)<=c){if(!U(u,n.length))return NaN;if(t){const f=zr(n,u,e,r);if(isNaN(f)||f===0)return f;s=Math.min(s,f)}else for(let f=u[0];f<=u[1];++f){const p=Fr(n[f],e,r);if(s=Math.min(s,p),s===0)return 0}}else{const f=ge(u,t);fn(o,s,r,n,a,f[0]),fn(o,s,r,n,a,f[1])}}return s}function _t(n,t,e,r,i,s=1/0){let o=Math.min(s,i.distance(n[0],e[0]));if(o===0)return o;const a=new rn([[0,[0,n.length-1],[0,e.length-1]]],ln);for(;a.length>0;){const l=a.pop();if(l[0]>=o)continue;const u=l[1],c=l[2],f=t?ye:de,p=r?ye:de;if(jt(u)<=f&&jt(c)<=p){if(!U(u,n.length)&&U(c,e.length))return NaN;let d;if(t&&r)d=Ar(n,u,e,c,i),o=Math.min(o,d);else if(t&&!r){const y=n.slice(u[0],u[1]+1);for(let w=c[0];w<=c[1];++w)if(d=Z(e[w],y,i),o=Math.min(o,d),o===0)return o}else if(!t&&r){const y=e.slice(c[0],c[1]+1);for(let w=u[0];w<=u[1];++w)if(d=Z(n[w],y,i),o=Math.min(o,d),o===0)return o}else d=Dr(n,u,e,c,i),o=Math.min(o,d)}else{const d=ge(u,t),y=ge(c,r);Ot(a,o,i,n,e,d[0],y[0]),Ot(a,o,i,n,e,d[0],y[1]),Ot(a,o,i,n,e,d[1],y[0]),Ot(a,o,i,n,e,d[1],y[1])}}return o}function jr(n,t){const e=n.geometry(),r=e.flat().map(o=>fe([o.x,o.y],n.canonical));if(e.length===0)return NaN;const i=new pe(r[0][1]);let s=1/0;for(const o of t){switch(o.type){case"Point":s=Math.min(s,_t(r,!1,[o.coordinates],!1,i,s));break;case"LineString":s=Math.min(s,_t(r,!1,o.coordinates,!0,i,s));break;case"Polygon":s=Math.min(s,Rt(r,!1,o.coordinates,i,s));break}if(s===0)return s}return s}function Or(n,t){const e=n.geometry(),r=e.flat().map(o=>fe([o.x,o.y],n.canonical));if(e.length===0)return NaN;const i=new pe(r[0][1]);let s=1/0;for(const o of t){switch(o.type){case"Point":s=Math.min(s,_t(r,!0,[o.coordinates],!1,i,s));break;case"LineString":s=Math.min(s,_t(r,!0,o.coordinates,!0,i,s));break;case"Polygon":s=Math.min(s,Rt(r,!0,o.coordinates,i,s));break}if(s===0)return s}return s}function Rr(n,t){const e=n.geometry();if(e.length===0||e[0].length===0)return NaN;const r=Gn(e).map(o=>o.map(a=>a.map(l=>fe([l.x,l.y],n.canonical)))),i=new pe(r[0][0][0][1]);let s=1/0;for(const o of t)for(const a of r){switch(o.type){case"Point":s=Math.min(s,Rt([o.coordinates],!1,a,i,s));break;case"LineString":s=Math.min(s,Rt(o.coordinates,!0,a,i,s));break;case"Polygon":s=Math.min(s,Br(a,o.coordinates,i,s));break}if(s===0)return s}return s}function Ce(n){return n.type==="MultiPolygon"?n.coordinates.map(t=>({type:"Polygon",coordinates:t})):n.type==="MultiLineString"?n.coordinates.map(t=>({type:"LineString",coordinates:t})):n.type==="MultiPoint"?n.coordinates.map(t=>({type:"Point",coordinates:t})):[n]}class J{constructor(t,e){this.type=h,this.geojson=t,this.geometries=e}static parse(t,e){if(t.length!==2)return e.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ht(t[1])){const r=t[1];if(r.type==="FeatureCollection")return new J(r,r.features.map(i=>Ce(i.geometry)).flat());if(r.type==="Feature")return new J(r,Ce(r.geometry));if("type"in r&&"coordinates"in r)return new J(r,Ce(r))}return e.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return jr(t,this.geometries);if(t.geometryType()==="LineString")return Or(t,this.geometries);if(t.geometryType()==="Polygon")return Rr(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const ke={"==":hr,"!=":pr,">":yr,"<":dr,">=":mr,"<=":gr,array:z,at:ee,boolean:z,case:ie,coalesce:dt,collator:zt,format:le,image:ue,in:ne,"index-of":Lt,interpolate:F,"interpolate-hcl":F,"interpolate-lab":F,length:ce,let:Nt,literal:rt,match:re,number:z,"number-format":ae,object:z,slice:At,step:Ft,string:z,"to-boolean":W,"to-color":W,"to-number":W,"to-string":W,var:$t,within:X,distance:J};class B{constructor(t,e,r,i){this.name=t,this.type=e,this._evaluate=r,this.args=i}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,e){const r=t[0],i=B.definitions[r];if(!i)return e.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,a=o.filter(([u])=>!Array.isArray(u)||u.length===t.length-1);let l=null;for(const[u,c]of a){l=new Pt(e.registry,Ht,e.path,null,e.scope);const f=[];let p=!1;for(let d=1;d<t.length;d++){const y=t[d],w=Array.isArray(u)?u[d-1]:u.type,x=l.parse(y,1+f.length,w);if(!x){p=!0;break}f.push(x)}if(!p){if(Array.isArray(u)&&u.length!==f.length){l.error(`Expected ${u.length} arguments, but found ${f.length} instead.`);continue}for(let d=0;d<f.length;d++){const y=Array.isArray(u)?u[d]:u.type,w=f[d];l.concat(d+1).checkSubtype(y,w.type)}if(l.errors.length===0)return new B(r,s,c,f)}}if(a.length===1)e.errors.push(...l.errors);else{const c=(a.length?a:o).map(([p])=>Hr(p)).join(" | "),f=[];for(let p=1;p<t.length;p++){const d=e.parse(t[p],1+f.length);if(!d)return null;f.push(k(d.type))}e.error(`Expected arguments of type ${c}, but found (${f.join(", ")}) instead.`)}return null}static register(t,e){B.definitions=e;for(const r in e)t[r]=B}}function hn(n,[t,e,r,i]){t=t.evaluate(n),e=e.evaluate(n),r=r.evaluate(n);const s=i?i.evaluate(n):1,o=Ue(t,e,r,s);if(o)throw new E(o);return new C(t/255,e/255,r/255,s,!1)}function pn(n,t){return n in t}function Me(n,t){const e=t[n];return typeof e>"u"?null:e}function _r(n,t,e,r){for(;e<=r;){const i=e+r>>1;if(t[i]===n)return!0;t[i]>n?r=i-1:e=i+1}return!1}function Y(n){return{type:n}}B.register(ke,{error:[Fn,[v],(n,[t])=>{throw new E(t.evaluate(n))}],typeof:[v,[b],(n,[t])=>k(I(t.evaluate(n)))],"to-rgba":[L(h,4),[O],(n,[t])=>{const[e,r,i,s]=t.evaluate(n).rgb;return[e*255,r*255,i*255,s]}],rgb:[O,[h,h,h],hn],rgba:[O,[h,h,h,h],hn],has:{type:m,overloads:[[[v],(n,[t])=>pn(t.evaluate(n),n.properties())],[[v,K],(n,[t,e])=>pn(t.evaluate(n),e.evaluate(n))]]},get:{type:b,overloads:[[[v],(n,[t])=>Me(t.evaluate(n),n.properties())],[[v,K],(n,[t,e])=>Me(t.evaluate(n),e.evaluate(n))]]},"feature-state":[b,[v],(n,[t])=>Me(t.evaluate(n),n.featureState||{})],properties:[K,[],n=>n.properties()],"geometry-type":[v,[],n=>n.geometryType()],id:[b,[],n=>n.id()],zoom:[h,[],n=>n.globals.zoom],"heatmap-density":[h,[],n=>n.globals.heatmapDensity||0],"line-progress":[h,[],n=>n.globals.lineProgress||0],accumulated:[b,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[h,Y(h),(n,t)=>{let e=0;for(const r of t)e+=r.evaluate(n);return e}],"*":[h,Y(h),(n,t)=>{let e=1;for(const r of t)e*=r.evaluate(n);return e}],"-":{type:h,overloads:[[[h,h],(n,[t,e])=>t.evaluate(n)-e.evaluate(n)],[[h],(n,[t])=>-t.evaluate(n)]]},"/":[h,[h,h],(n,[t,e])=>t.evaluate(n)/e.evaluate(n)],"%":[h,[h,h],(n,[t,e])=>t.evaluate(n)%e.evaluate(n)],ln2:[h,[],()=>Math.LN2],pi:[h,[],()=>Math.PI],e:[h,[],()=>Math.E],"^":[h,[h,h],(n,[t,e])=>Math.pow(t.evaluate(n),e.evaluate(n))],sqrt:[h,[h],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[h,[h],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[h,[h],(n,[t])=>Math.log(t.evaluate(n))],log2:[h,[h],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[h,[h],(n,[t])=>Math.sin(t.evaluate(n))],cos:[h,[h],(n,[t])=>Math.cos(t.evaluate(n))],tan:[h,[h],(n,[t])=>Math.tan(t.evaluate(n))],asin:[h,[h],(n,[t])=>Math.asin(t.evaluate(n))],acos:[h,[h],(n,[t])=>Math.acos(t.evaluate(n))],atan:[h,[h],(n,[t])=>Math.atan(t.evaluate(n))],min:[h,Y(h),(n,t)=>Math.min(...t.map(e=>e.evaluate(n)))],max:[h,Y(h),(n,t)=>Math.max(...t.map(e=>e.evaluate(n)))],abs:[h,[h],(n,[t])=>Math.abs(t.evaluate(n))],round:[h,[h],(n,[t])=>{const e=t.evaluate(n);return e<0?-Math.round(-e):Math.round(e)}],floor:[h,[h],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[h,[h],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[m,[v,b],(n,[t,e])=>n.properties()[t.value]===e.value],"filter-id-==":[m,[b],(n,[t])=>n.id()===t.value],"filter-type-==":[m,[v],(n,[t])=>n.geometryDollarType()===t.value],"filter-<":[m,[v,b],(n,[t,e])=>{const r=n.properties()[t.value],i=e.value;return typeof r==typeof i&&r<i}],"filter-id-<":[m,[b],(n,[t])=>{const e=n.id(),r=t.value;return typeof e==typeof r&&e<r}],"filter->":[m,[v,b],(n,[t,e])=>{const r=n.properties()[t.value],i=e.value;return typeof r==typeof i&&r>i}],"filter-id->":[m,[b],(n,[t])=>{const e=n.id(),r=t.value;return typeof e==typeof r&&e>r}],"filter-<=":[m,[v,b],(n,[t,e])=>{const r=n.properties()[t.value],i=e.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[m,[b],(n,[t])=>{const e=n.id(),r=t.value;return typeof e==typeof r&&e<=r}],"filter->=":[m,[v,b],(n,[t,e])=>{const r=n.properties()[t.value],i=e.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[m,[b],(n,[t])=>{const e=n.id(),r=t.value;return typeof e==typeof r&&e>=r}],"filter-has":[m,[b],(n,[t])=>t.value in n.properties()],"filter-has-id":[m,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[m,[L(v)],(n,[t])=>t.value.indexOf(n.geometryDollarType())>=0],"filter-id-in":[m,[L(b)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[m,[v,L(b)],(n,[t,e])=>e.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[m,[v,L(b)],(n,[t,e])=>_r(n.properties()[t.value],e.value,0,e.value.length-1)],all:{type:m,overloads:[[[m,m],(n,[t,e])=>t.evaluate(n)&&e.evaluate(n)],[Y(m),(n,t)=>{for(const e of t)if(!e.evaluate(n))return!1;return!0}]]},any:{type:m,overloads:[[[m,m],(n,[t,e])=>t.evaluate(n)||e.evaluate(n)],[Y(m),(n,t)=>{for(const e of t)if(e.evaluate(n))return!0;return!1}]]},"!":[m,[m],(n,[t])=>!t.evaluate(n)],"is-supported-script":[m,[v],(n,[t])=>{const e=n.globals&&n.globals.isSupportedScript;return e?e(t.evaluate(n)):!0}],upcase:[v,[v],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[v,[v],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[v,Y(b),(n,t)=>t.map(e=>pt(e.evaluate(n))).join("")],"resolved-locale":[v,[Mt],(n,[t])=>t.evaluate(n).resolvedLocale()]});function Hr(n){return Array.isArray(n)?`(${n.map(k).join(", ")})`:`(${k(n.type)}...)`}function Ht(n){if(n instanceof $t)return Ht(n.boundExpression);if(n instanceof B&&n.name==="error")return!1;if(n instanceof zt)return!1;if(n instanceof X)return!1;if(n instanceof J)return!1;const t=n instanceof W||n instanceof z;let e=!0;return n.eachChild(r=>{t?e=e&&Ht(r):e=e&&r instanceof rt}),e?Ee(n)&&xe(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"]):!1}function Ee(n){if(n instanceof B){if(n.name==="get"&&n.args.length===1)return!1;if(n.name==="feature-state")return!1;if(n.name==="has"&&n.args.length===1)return!1;if(n.name==="properties"||n.name==="geometry-type"||n.name==="id")return!1;if(/^filter-/.test(n.name))return!1}if(n instanceof X||n instanceof J)return!1;let t=!0;return n.eachChild(e=>{t&&!Ee(e)&&(t=!1)}),t}function Ie(n){if(n instanceof B&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(e=>{t&&!Ie(e)&&(t=!1)}),t}function xe(n,t){if(n instanceof B&&t.indexOf(n.name)>=0)return!1;let e=!0;return n.eachChild(r=>{e&&!xe(r,t)&&(e=!1)}),e}function Te(n){return{result:"success",value:n}}function ot(n){return{result:"error",value:n}}function Ur(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function qr(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function dn(n){return!!n.expression&&n.expression.interpolated}function Se(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function yn(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Vr(n){return n}function gn(n,t){const e=t.type==="color",r=n.stops&&typeof n.stops[0][0]=="object",i=r||n.property!==void 0,s=r||!i,o=n.type||(dn(t)?"exponential":"interval");if(e||t.type==="padding"){const c=e?C.parse:N.parse;n=Le({},n),n.stops&&(n.stops=n.stops.map(f=>[f[0],c(f[1])])),n.default?n.default=c(n.default):n.default=c(t.default)}if(n.colorSpace&&!Vn(n.colorSpace))throw new Error(`Unknown color space: "${n.colorSpace}"`);let a,l,u;if(o==="exponential")a=mn;else if(o==="interval")a=Gr;else if(o==="categorical"){a=Wr,l=Object.create(null);for(const c of n.stops)l[c[0]]=c[1];u=typeof n.stops[0][0]}else if(o==="identity")a=Xr;else throw new Error(`Unknown function type "${o}"`);if(r){const c={},f=[];for(let y=0;y<n.stops.length;y++){const w=n.stops[y],x=w[0].zoom;c[x]===void 0&&(c[x]={zoom:x,type:n.type,property:n.property,default:n.default,stops:[]},f.push(x)),c[x].stops.push([w[0].value,w[1]])}const p=[];for(const y of f)p.push([c[y].zoom,gn(c[y],t)]);const d={name:"linear"};return{kind:"composite",interpolationType:d,interpolationFactor:F.interpolationFactor.bind(void 0,d),zoomStops:p.map(y=>y[0]),evaluate({zoom:y},w){return mn({stops:p,base:n.base},t,y).evaluate(y,w)}}}else if(s){const c=o==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:c,interpolationFactor:F.interpolationFactor.bind(void 0,c),zoomStops:n.stops.map(f=>f[0]),evaluate:({zoom:f})=>a(n,t,f,l,u)}}else return{kind:"source",evaluate(c,f){const p=f&&f.properties?f.properties[n.property]:void 0;return p===void 0?mt(n.default,t.default):a(n,t,p,l,u)}}}function mt(n,t,e){if(n!==void 0)return n;if(t!==void 0)return t;if(e!==void 0)return e}function Wr(n,t,e,r,i){const s=typeof e===i?r[e]:void 0;return mt(s,n.default,t.default)}function Gr(n,t,e){if(Se(e)!=="number")return mt(n.default,t.default);const r=n.stops.length;if(r===1||e<=n.stops[0][0])return n.stops[0][1];if(e>=n.stops[r-1][0])return n.stops[r-1][1];const i=Dt(n.stops.map(s=>s[0]),e);return n.stops[i][1]}function mn(n,t,e){const r=n.base!==void 0?n.base:1;if(Se(e)!=="number")return mt(n.default,t.default);const i=n.stops.length;if(i===1||e<=n.stops[0][0])return n.stops[0][1];if(e>=n.stops[i-1][0])return n.stops[i-1][1];const s=Dt(n.stops.map(c=>c[0]),e),o=Zr(e,r,n.stops[s][0],n.stops[s+1][0]),a=n.stops[s][1],l=n.stops[s+1][1],u=tr[t.type]||Vr;return typeof a.evaluate=="function"?{evaluate(...c){const f=a.evaluate.apply(void 0,c),p=l.evaluate.apply(void 0,c);if(!(f===void 0||p===void 0))return u(f,p,o,n.colorSpace)}}:u(a,l,o,n.colorSpace)}function Xr(n,t,e){switch(t.type){case"color":e=C.parse(e);break;case"formatted":e=R.fromString(e.toString());break;case"resolvedImage":e=H.fromString(e.toString());break;case"padding":e=N.parse(e);break;default:Se(e)!==t.type&&(t.type!=="enum"||!t.values[e])&&(e=void 0)}return mt(e,n.default,t.default)}function Zr(n,t,e,r){const i=r-e,s=n-e;return i===0?0:t===1?s/i:(Math.pow(t,s)-1)/(Math.pow(t,i)-1)}class bn{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new Ge,this._defaultValue=e?Kr(e):null,this._enumValues=e&&e.type==="enum"?e.values:null}evaluateWithoutErrorHandling(t,e,r,i,s,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.canonical=i,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(t,e,r,i,s,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.canonical=i,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o||null;try{const a=this.expression.evaluate(this._evaluator);if(a==null||typeof a=="number"&&a!==a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new E(`Expected value to be one of ${Object.keys(this._enumValues).map(l=>JSON.stringify(l)).join(", ")}, but found ${JSON.stringify(a)} instead.`);return a}catch(a){return this._warningHistory[a.message]||(this._warningHistory[a.message]=!0,typeof console<"u"&&console.warn(a.message)),this._defaultValue}}}function vn(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in ke}function wn(n,t){const e=new Pt(ke,Ht,[],t?Qr(t):void 0),r=e.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return r?Te(new bn(r,t)):ot(e.errors)}class Pe{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent=t!=="constant"&&!Ie(e.expression)}evaluateWithoutErrorHandling(t,e,r,i,s,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,i,s,o)}evaluate(t,e,r,i,s,o){return this._styleExpression.evaluate(t,e,r,i,s,o)}}class Ne{constructor(t,e,r,i){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent=t!=="camera"&&!Ie(e.expression),this.interpolationType=i}evaluateWithoutErrorHandling(t,e,r,i,s,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,i,s,o)}evaluate(t,e,r,i,s,o){return this._styleExpression.evaluate(t,e,r,i,s,o)}interpolationFactor(t,e,r){return this.interpolationType?F.interpolationFactor(this.interpolationType,t,e,r):0}}function Jr(n){return n._styleExpression!==void 0}function Cn(n,t){const e=wn(n,t);if(e.result==="error")return e;const r=e.value.expression,i=Ee(r);if(!i&&!Ur(t))return ot([new j("","data expressions not supported")]);const s=xe(r,["zoom"]);if(!s&&!qr(t))return ot([new j("","zoom expressions not supported")]);const o=qt(r);if(!o&&!s)return ot([new j("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof j)return ot([o]);if(o instanceof F&&!dn(t))return ot([new j("",'"interpolate" expressions cannot be used with this property')]);if(!o)return Te(i?new Pe("constant",e.value):new Pe("source",e.value));const a=o instanceof F?o.interpolation:void 0;return Te(i?new Ne("camera",e.value,o.labels,a):new Ne("composite",e.value,o.labels,a))}class Ut{constructor(t,e){this._parameters=t,this._specification=e,Le(this,gn(this._parameters,this._specification))}static deserialize(t){return new Ut(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Yr(n,t){if(yn(n))return new Ut(n,t);if(vn(n)){const e=Cn(n,t);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return e.value}else{let e=n;return t.type==="color"&&typeof n=="string"?e=C.parse(n):t.type==="padding"&&(typeof n=="number"||Array.isArray(n))?e=N.parse(n):t.type==="variableAnchorOffsetCollection"&&Array.isArray(n)?e=A.parse(n):t.type==="projectionDefinition"&&typeof n=="string"&&(e=D.parse(n)),{kind:"constant",evaluate:()=>e}}}function qt(n){let t=null;if(n instanceof Nt)t=qt(n.result);else if(n instanceof dt){for(const e of n.args)if(t=qt(e),t)break}else(n instanceof Ft||n instanceof F)&&n.input instanceof B&&n.input.name==="zoom"&&(t=n);return t instanceof j||n.eachChild(e=>{const r=qt(e);r instanceof j?t=r:!t&&r?t=new j("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&r&&t!==r&&(t=new j("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Qr(n){const t={color:O,string:v,number:h,enum:v,boolean:m,formatted:Et,padding:It,projectionDefinition:kt,resolvedImage:ut,variableAnchorOffsetCollection:xt};return n.type==="array"?L(t[n.value]||b,n.length):t[n.type]}function Kr(n){return n.type==="color"&&yn(n.default)?new C(0,0,0,0):n.type==="color"?C.parse(n.default)||null:n.type==="padding"?N.parse(n.default)||null:n.type==="variableAnchorOffsetCollection"?A.parse(n.default)||null:n.type==="projectionDefinition"?D.parse(n.default)||null:n.default===void 0?null:n.default}function kn(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!kn(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const ti={StyleExpression:bn,StylePropertyFunction:Ut,ZoomConstantExpression:Pe,ZoomDependentExpression:Ne,createExpression:wn,createPropertyExpression:Cn,isExpression:vn,isExpressionFilter:kn,isZoomExpression:Jr,normalizePropertyExpression:Yr},M={color:{text:"rgba(255, 255, 255, 1.0)",border:"rgba(0, 36, 71, 0.4)",borderLight:"#dee2e6",background:"rgba(0, 36, 71, 0.6)",hover:"rgba(0, 36, 71, 0.8)",activeBackground:"rgba(0, 36, 71, 0.98)"},radius:{sm:"3px",md:"4px",lg:"6px"},shadow:{sm:"0 1px 2px rgba(0, 36, 71, 0.05)",md:"0 2px 4px rgba(0, 36, 71, 0.1)"},font:{family:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif",size:"11px"},transition:"all 0.2s ease"},Mn=new Set;function ei(n){n.style.setProperty("--rp-mctl-text",M.color.text),n.style.setProperty("--rp-mctl-background",M.color.background),n.style.setProperty("--rp-mctl-hover",M.color.hover),n.style.setProperty("--rp-mctl-border",M.color.border),n.style.setProperty("--rp-mctl-borderLight",M.color.borderLight),n.style.setProperty("--rp-mctl-radius-sm",M.radius.sm),n.style.setProperty("--rp-mctl-radius-md",M.radius.md),n.style.setProperty("--rp-mctl-radius-lg",M.radius.lg),n.style.setProperty("--rp-mctl-shadow-sm",M.shadow.sm),n.style.setProperty("--rp-mctl-shadow-md",M.shadow.md),n.style.setProperty("--rp-mctl-font-family",M.font.family),n.style.setProperty("--rp-mctl-font-size",M.font.size)}function ni(n){Mn.add(n),ei(n)}function ri(n){Mn.delete(n)}const ii={backgroundColor:"transparent",padding:"5px",border:"transparent",boxShadow:"none",borderRadius:M.radius.md,display:"flex",flexDirection:"column",gap:"4px",fontFamily:M.font.family,fontSize:M.font.size,color:M.color.text};function $e(n,t={}){Object.assign(n.style,ii),n.classList.add("maplibregl-ctrl","maplibregl-ctrl-group"),t.classNames&&t.classNames.forEach(e=>n.classList.add(e))}const si={display:"flex",alignItems:"center",gap:"4px",padding:"4px 6px",border:"none",cursor:"pointer",borderRadius:M.radius.md,width:"fit-content",color:M.color.text,backgroundColor:M.color.background,fontSize:M.font.size,whiteSpace:"nowrap"},bt={iconWidth:20,btnPaddingX:6,btnPaddingY:4,btnGap:4,smallScreenThreshold:768,minFontSize:10,maxFontSize:16,scalingFactor:.5},at=new Map;function En(n,t){at.has(n)||at.set(n,new Map);const e=at.get(n);t.forEach((r,i)=>{e==null||e.set(i,r)})}function In(n,t){const e=at.get(n);e&&(Object.entries(t).forEach(([r])=>{e.delete(r)}),e.size===0&&at.delete(n))}function xn(n){const t=document.createElement("button");if(Object.assign(t.style,si),n.backgroundColor&&(t.style.backgroundColor=n.backgroundColor),n.className&&(t.className=n.className),n.title&&(t.title=n.title),n.onClick&&(t.onclick=n.onClick),n.icon)if(typeof n.icon=="string"){const r=document.createElement("div");r.innerHTML=n.icon,t.appendChild(r)}else t.appendChild(n.icon);const e=document.createElement("span");return e.textContent=n.label,e.style.fontSize=M.font.size,e.style.color="inherit",t.appendChild(e),t}function oi(n,t,e=20){const r=document.createElement("img");return r.src=`data:image/svg+xml,${encodeURIComponent(n)}`,r.alt=t,r.style.width=`${e}px`,r.style.height=`${e}px`,r.style.color="white",r}function ai(n){return n.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function li(n,t,e=bt.maxFontSize,r=bt.minFontSize){const{iconWidth:i,btnPaddingX:s,btnGap:o,scalingFactor:a}=bt,l=n-i-s*2-o,u=t.replace(/<[^>]+>/g,"").length;if(u===0)return r;let c=Math.floor(l/(u*a));return c=Math.min(e,Math.max(r,c)),c}function Tn(n,t){const e=at.get(n);if(!e||e.size===0)return;const r=Array.from(e.values()),{smallScreenThreshold:i}=bt,s=t<i;r.forEach(l=>{const u=l.querySelector("span");u&&(u.style.display=s?"none":"inline"),l.style.width="fit-content"});const o=Math.max(...r.map(l=>l.offsetWidth)),a=s?"34px":`${o}px`;if(r.forEach(l=>{l.style.width=a}),!s){const l=r.map(c=>{const f=c.querySelector("span");return!f||!f.textContent?null:[f,li(o,f.textContent)]}).filter(c=>!!c),u=Math.max(bt.minFontSize,Math.min(...l.map(([,c])=>c)));l.forEach(([c])=>{c.style.fontSize=`${u}px`})}}function ui(n,t,e){const r=n.offsetWidth,i=n.offsetHeight;let s=10,o=10,a=Math.max(0,parseFloat(getComputedStyle(n).getPropertyValue("env(safe-area-inset-left)")||"0")),l=Math.max(0,parseFloat(getComputedStyle(n).getPropertyValue("env(safe-area-inset-right)")||"0")),u=a,c=l;r>=480&&(s=15,o=15,u=Math.max(15,a),c=Math.max(15,l)),i>=992&&(s=40,o=40),r>=992&&(u=Math.max(40,a),c=Math.max(40,l)),t!=null&&t.endsWith("left")?(u=u,c=l):(u=a,c=c);const f=e==null?void 0:e.margin,p=e==null?void 0:e.marginTop,d=e==null?void 0:e.marginBottom,y=e==null?void 0:e.marginLeft,w=e==null?void 0:e.marginRight;return{marginTop:f||p?null:s,marginBottom:f||d?null:o,marginLeft:f||y?null:u,marginRight:f||w?null:c}}function Vt(n,t,e,r){const{marginTop:i,marginBottom:s,marginLeft:o,marginRight:a}=ui(t,e,r);i!==null&&(n.style.marginTop=`${i}px`),s!==null&&(n.style.marginBottom=`${s}px`),o!==null&&(n.style.marginLeft=`${o}px`),a!==null&&(n.style.marginRight=`${a}px`)}class ci{constructor(t,e){g(this,"map");g(this,"options");g(this,"colorSteps");g(this,"container");g(this,"outContainer");g(this,"titleDiv");g(this,"unitDiv");g(this,"legendItems",[]);g(this,"propertySpec");g(this,"handleContainerClick",t=>{this.options.onClick&&this.options.onClick(t,this,this.options)});t?this.propertySpec=t:this.propertySpec={"fill-color":{default:["step",["get","speed"],"#ff3f00",.1,"#ff7e00",.15,"#ffbe00",.2,"#fffd00",.25,"#c0ff00",.3,"#81ff00",.35,"#41ff00",.4,"#02ff00",.45,"#00ff3d",.5,"#00ff7c",.55,"#00ffbc",.6,"#00fffb",.65,"#00c2ff",.7,"#0083ff",.75,"#0043ff",.8,"#0004ff",.85,"#3b00ff",.9,"#7a00ff",.95,"#ba00ff",.98,"#f900ff",1,"#f900ff"],doc:"The color of each pixel of this layer",expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"fill-opacity":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},this.options={position:"top-left",width:"50px",height:"272px",max:30,decimal:1,tickMinStep:0,...e},this.colorSteps=this.getColorSteps();const{outContainer:r,innerContainer:i}=this.createContainer();this.outContainer=r,this.container=i,this.titleDiv=this.createTitleDiv(this.options.title),this.unitDiv=this.createUnitDiv(this.options.unit),this.container.appendChild(this.titleDiv),this.container.appendChild(this.unitDiv),this.options.onClick&&this.container.addEventListener("click",this.handleContainerClick),this.options.style&&Object.assign(this.container.style,this.options.style)}getTickMinStep(){return this.options.tickMinStep||0}getWidth(){return this.options.width||"52px"}getHeight(){return this.options.height||"272px"}getHeightInPixels(){const t=this.getHeight();if(t.endsWith("px"))return parseFloat(t);if(t.endsWith("%")){const e=this.outContainer.offsetHeight,r=parseFloat(t)/100;return e*r}return 272}createContainer(){var i;const t=document.createElement("div");$e(t,{classNames:["maplibregl-ctrl"]}),t.style.height="100%",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.backgroundColor="transparent",t.style.pointerEvents="none",t.style.margin="0";const e=(i=this.options.position)!=null&&i.endsWith("left")?"map-colorbar-left-group":"map-colorbar-right-group",r=document.createElement("div");return r.classList.add(e),r.classList.add("rp-colorBar"),r.style.width=this.getWidth(),r.style.height=`calc(min((100% - 29px), ${this.getHeight()}))`,r.style.backgroundColor="rgba(0, 36, 71, 0.8)",r.style.display="flex",r.style.flexDirection="column",r.style.borderRadius="10px",r.style.pointerEvents="auto",t.appendChild(r),{outContainer:t,innerContainer:r}}createTitleDiv(t){const e=document.createElement("div");return e.classList.add("map_colorbar_title"),e.innerHTML=t,e.style.marginTop="6px",e.style.marginBottom="8px",e.style.display="flex",e.style.justifyContent="center",e.style.textAlign="center",e.style.fontSize="11px",e.style.lineHeight="14px",e.style.color="white",e.style.width=this.getWidth(),e}createUnitDiv(t){const e=document.createElement("div");return e.classList.add("map_colorbar_unit"),e.innerHTML=`(${t})`,e.style.marginTop="8px",e.style.width=this.getWidth(),e.style.display="flex",e.style.justifyContent="center",e.style.color="white",e.style.fontSize="12px",e.style.textAlign="center",e}createColorBox(t){const e=document.createElement("div");return e.classList.add("map_colorbar_color_box"),e.style.width="12px",e.style.backgroundColor=t,e}createLabel(t){const e=document.createElement("div");return e.classList.add("map_colorbar_label"),e.style.marginTop="0px",e.style.marginLeft="0px",e.style.marginRight="2px",e.style.color="white",e.style.fontSize="9px",e.textContent="",e}initializeLegendItems(){this.colorSteps.forEach(({speed:t,color:e})=>{const r=document.createElement("div");r.classList.add("map_colorbar_item"),r.style.display="flex",r.style.alignItems="center",r.style.marginBottom="0px",r.style.marginTop="0px",r.style.marginLeft="10px";const i=this.createColorBox(e),s=this.createLabel({speed:t,color:e});r.appendChild(i),r.appendChild(s),this.legendItems.push(r),this.container.insertBefore(r,this.unitDiv)})}calculateHeights(){const t=this.getHeightInPixels(),i=(this.container.getBoundingClientRect().height?this.container.getBoundingClientRect().height:t)-this.titleDiv.offsetHeight-this.unitDiv.offsetHeight-22,s=Math.max(Math.floor(i/this.colorSteps.length),5),o=Math.ceil(20*this.colorSteps.length/i);return{stepHeight:s,showInterval:o}}update(){this.updateInnerContainerStyle(this.outContainer,this.container);const{stepHeight:t,showInterval:e}=this.calculateHeights();let r=this.colorSteps.length-1;[...this.legendItems].reverse().forEach((i,s)=>{const o=i.querySelector(".map_colorbar_color_box"),a=i.querySelector(".map_colorbar_label"),l=s===0?t+3:t;i.style.height=`${t}px`,o.style.height=`${l}px`;let u=this.colorSteps.length-1-s;const c=this.colorSteps[u].speed,f=this.colorSteps[r].speed,p=Math.abs(c-f);(this.getTickMinStep()==0&&e>0&&s%e!==0||p<this.getTickMinStep())&&u<r?a.textContent="":(a.textContent=`- ${c.toFixed(this.options.decimal)}`,r=u,a.style.marginTop=`${t}px`)})}onAdd(t){return this.map=t,t.getContainer().appendChild(this.outContainer),this.initializeLegendItems(),this.update(),this.map.once("styledata",()=>{this.refresh()}),this.map.on("resize",()=>{this.update()}),this.outContainer}onRemove(){var t;this.map&&(this.map.off("resize",this.update),this.map.off("styledata",this.refresh)),(t=this.outContainer.parentNode)==null||t.removeChild(this.outContainer),this.map=void 0}refresh(){}getPosition(){return this.options.position||"top-left"}updateOptions(t){const e={...this.options};if(this.options={...this.options,...t},t.max!==void 0&&t.tickMinStep,t.title!==void 0&&(this.titleDiv.innerHTML=t.title),t.unit!==void 0&&(this.unitDiv.innerHTML=`(${t.unit})`),(t.width!==void 0||t.height!==void 0)&&(this.container.style.width=this.getWidth(),this.container.style.height=`calc(min((100% - 29px), ${this.getHeight()}))`),t.max!==void 0){if(t.tickMinStep===void 0){const r=e.tickMinStep??0,i=e.max??30;this.options.tickMinStep=r*t.max/i}this.colorSteps=this.getColorSteps(),this.legendItems.forEach(r=>r.remove()),this.legendItems=[],this.initializeLegendItems()}t.onClick!==void 0&&this.container.removeEventListener("click",this.handleContainerClick),this.update()}getOptions(){return this.options}getMap(){return this.map}updateInnerContainerStyle(t,e){var s;if(!this.map)return;const r=this.map.getContainer(),i=r.offsetHeight;t.style.height=`${i}px`,Vt(e,r,this.options.position||"top-left",(s=this.options)==null?void 0:s.style),e.style.alignItems="flex-start",e.style.display="flex",e.style.height=`calc(min((100% - 50px), ${this.getHeight()}))`}getColorSteps(){var l;const t=this.propertySpec["fill-color"];if(!t)throw new Error("Missing 'fill-color' specification.");const e=t.default||t;if(e[0]!=="step")throw new Error("Only 'step' expressions are supported.");const i=[],[,,s,...o]=e,a=((l=this.options)==null?void 0:l.max)||30;i.push({speed:0,color:s});for(let u=0;u<o.length;u+=2){const f=o[u]*a,p=o[u+1];i.push({speed:f,color:p})}return i.sort((u,c)=>c.speed-u.speed)}setProperty(t,e){const r=this.propertySpec[t];if(!r)throw new Error(`Property "${t}" is not defined in the specification.`);const i=ti.createPropertyExpression(e,r);if(i.result==="success")switch(i.value.kind){case"camera":case"composite":console.log(`Camera/composite expression set for property "${t}"`);break;default:console.log(`Property "${t}" set with value`,i.value);break}else throw new Error(`Invalid expression for property "${t}": ${i.value}`)}}class fi{constructor(t){g(this,"map");g(this,"options");g(this,"container");this.options={position:"top-left",width:"146px",height:"24px",...t},this.container=this.createContainer()}getWidth(){return this.options.width||"146px"}getHeight(){return this.options.height||"24px"}createContainer(){const t=document.createElement("div");return t.className="maplibregl-ctrl maplibregl-ctrl-msg",this.options.innerClassName&&t.classList.add(this.options.innerClassName),t.style.width=this.getWidth(),t.style.height=this.getHeight(),t.style.backgroundColor="rgba(0, 36, 71, 0.7)",t.style.padding="5px 10px",t.style.borderRadius="3px",t.style.fontFamily="Arial, sans-serif",t.style.fontSize="14px",this.options.innerHTML?t.innerHTML=this.options.innerHTML:this.options.msg&&(t.textContent=this.options.msg),this.options.style&&Object.assign(t.style,this.options.style),t}updateInnerContainerStyle(){if(!this.map)return;const t=this.map.getContainer(),e=this.options.position||"top-left";Vt(this.container,t,e,this.options.style)}update(){this.updateInnerContainerStyle()}onAdd(t){return this.map=t,t.getContainer().appendChild(this.container),this.update(),this.map.once("styledata",()=>{this.refresh()}),this.map.on("resize",()=>{this.update()}),this.container}onRemove(){var t;this.map&&(this.map.off("resize",this.update),this.map.off("styledata",this.refresh)),(t=this.container.parentNode)==null||t.removeChild(this.container),this.map=void 0}refresh(){}updateStyle(t){this.container&&Object.assign(this.container.style,t)}updateContent(t,e=!1){this.container&&(e?this.container.innerHTML=t:this.container.textContent=t)}getPosition(){return this.options.position||"top-left"}}class hi{constructor(t){g(this,"map");g(this,"container");g(this,"options");g(this,"defaultActiveId");g(this,"activeButtonId",null);g(this,"buttons",new Map);g(this,"instanceId");g(this,"listeners",{toggle:new Set,untoggle:new Set});this.options=t,this.instanceId=this.generateInstanceId(),this.container=this.createContainer(),this.defaultActiveId=this.options.defaultActive}generateInstanceId(){return`togglectl-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}on(t,e){this.listeners[t].add(e)}off(t,e){this.listeners[t].delete(e)}emit(t){for(const e of this.listeners[t])try{e(this)}catch(r){console.error(`[ToggleCtl] error in ${t} listener`,r)}}createContainer(){const t=document.createElement("div");return t.id=this.instanceId,$e(t),this.options.innerClassName&&t.classList.add(this.options.innerClassName),this.options.width&&(t.style.width=this.options.width),this.options.height&&(t.style.height=this.options.height),this.options.style&&Object.assign(t.style,this.options.style),this.options.buttons.forEach(e=>{const r=this.createButton(e);t.appendChild(r),this.buttons.set(e.id,r)}),this.updateLayout(),t}updateInnerContainerStyle(){if(!this.map)return;const t=this.map.getContainer(),e=this.getPosition();Vt(this.container,t,e,this.options.style),this.container.style.alignItems="flex-start",this.container.style.display="flex",this.updateLayout()}updateLayout(){if(!this.map)return;const e=this.map.getContainer().clientWidth;Tn(this.getPosition(),e)}createButton(t){return xn({icon:oi(t.svg,t.label),label:t.label,onClick:()=>this.handleButtonClick(t)})}handleButtonClick(t){if(this.activeButtonId===t.id&&!t.repeat)return;const e=this.activeButtonId;if(t.repeat||(this.activeButtonId=t.id),e&&e!==this.activeButtonId&&this.map){const r=this.options.buttons.find(i=>i.id===e);r&&this.options.onUntoggle&&(this.options.onUntoggle(this,this.map,r),this.emit("untoggle"))}this.buttons.forEach((r,i)=>{i===this.activeButtonId?r.style.backgroundColor=M.color.activeBackground:r.style.backgroundColor=M.color.background}),this.map&&this.options.onToggle&&(this.options.onToggle(this,this.map,t),this.emit("toggle"))}onAdd(t){if(this.map=t,this.map.on("resize",()=>{this.updateInnerContainerStyle()}),this.map.on("styledata",()=>{this.updateInnerContainerStyle()}),this.options.buttons.forEach(e=>{e.setup&&e.setup(this,this.map)}),this.options.buttons.length>0&&!this.activeButtonId){const e=this.options.buttons.find(r=>r.id===this.defaultActiveId);this.handleButtonClick(e||this.options.buttons[0])}return En(this.getPosition(),this.buttons),this.container}onRemove(){var t;In(this.getPosition(),this.buttons),this.map&&(this.map.off("resize",this.updateInnerContainerStyle),this.map.off("styledata",this.updateInnerContainerStyle)),this.options.buttons.forEach(e=>{e.cleanup&&e.cleanup(this,this.map)}),(t=this.container.parentNode)==null||t.removeChild(this.container),this.map=void 0}getPosition(){var t;return((t=this.options)==null?void 0:t.position)||"top-right"}getInstanceId(){return this.instanceId}setActiveButton(t){const e=this.options.buttons.find(r=>r.id===t);e&&this.handleButtonClick(e)}getActiveButton(){const t=this.activeButtonId||this.defaultActiveId,e=this.options.buttons.find(r=>r.id===t);return e||this.options.buttons[0]}updateButton(t,e){const r=this.buttons.get(t),i=this.options.buttons.find(a=>a.id===t);if(!r||!i)return;Object.assign(i,e);const s=r.querySelector("img");s&&(e.svg&&(s.src=`data:image/svg+xml,${encodeURIComponent(e.svg)}`),e.label&&(s.alt=e.label));const o=r.querySelector("span");o&&e.label&&(o.textContent=e.label),this.updateLayout()}updateButtonCallback(t){t.forEach(e=>{const r=e.id||"",i=this.buttons.get(r),s=this.options.buttons.find(o=>o.id===r);!i||!s||Object.assign(s,e)})}updateStyle(t){this.container&&Object.assign(this.container.style,t)}}class pi{constructor(t={}){g(this,"map",null);g(this,"container",null);g(this,"panel",null);g(this,"buttons",new Map);g(this,"btnLabel","Settings");g(this,"feature","wave");g(this,"position");g(this,"collapsed",!1);g(this,"userStyle");g(this,"featureConfigGroups");g(this,"layerConfigs");g(this,"onChange");this.position=t.position||"top-right",this.collapsed=t.collapsed||!0,this.featureConfigGroups=t.featureConfigs||{},this.feature=t.feature||"wave",this.btnLabel=t.btnLabel||"Settings",this.layerConfigs=this.featureConfigGroups[this.feature]||{},this.onChange=t.onChange||((e,r,i,s)=>{console.log("Layer config changed:",e,r,i,s)}),t.style&&(this.userStyle=t.style)}onAdd(t){var i,s;this.map=t,this.container=document.createElement("div"),$e(this.container,{classNames:["layer-manager"]}),(i=this.position)!=null&&i.startsWith("bottom")?this.container.classList.add("bottom"):(s=this.position)!=null&&s.startsWith("top")&&this.container.classList.add("top"),this.userStyle&&Object.assign(this.container.style,this.userStyle),this.panel=document.createElement("div"),this.panel.className="layer-manager-panel",this.collapsed&&(this.panel.style.display="none");const e=this._createHeader(),r=this._createLayersSection();return this.container.appendChild(e),this.panel.appendChild(r),this.container.appendChild(this.panel),ni(this.container),En(this.getPosition(),this.buttons),this.map.on("resize",()=>{this._updateContainerPosition()}),this.map.on("styledata",()=>{this._updateContainerPosition()}),this.container}onRemove(){this.map&&(this.map.off("resize",this._updateContainerPosition),this.map.off("styledata",this._updateContainerPosition)),In(this.getPosition(),this.buttons),this.container&&ri(this.container),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.map=null}_updateContainerPosition(){if(!this.map||!this.container)return;const t=this.map.getContainer(),e=this.getPosition();Vt(this.container,t,e,this.userStyle),this._updateButtonLayout()}getPosition(){return this.position}_createLayersIcon(t=20){return`
      <svg
        width="${t}"
        height="${t}"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        style="vertical-align: middle; margin-right: 6px;"
      >
        <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
        <polyline points="2 17 12 22 22 17"></polyline>
        <polyline points="2 12 12 17 22 12"></polyline>
      </svg>
    `}_createHeader(){var r;const t=document.createElement("div");t.className="layer-manager-header",(r=this.position)!=null&&r.includes("left")?t.classList.add("left"):t.classList.add("right");const e=xn({icon:this._createLayersIcon(20),label:this.btnLabel,title:`${this.feature} Layers Settings`,onClick:()=>this._togglePanel(),className:"layer-manager-toggle"});return this.buttons.set("layer-manager-toggle",e),t.appendChild(e),t}_togglePanel(){this.panel&&(this.panel.style.display==="none"?(this.panel.style.display="",this.collapsed=!1):(this.panel.style.display="none",this.collapsed=!0))}_createLayersSection(){const t=document.createElement("div");t.className="layer-manager-section";const e=document.createElement("div");e.className="layer-manager-title",e.innerHTML=`<span style="vertical-align: middle;">${ai(this.feature)} Layers</span>`,t.appendChild(e);const r=document.createElement("div");return r.className="layer-manager-list",Object.entries(this.layerConfigs).forEach(([i,s])=>{const o=this._createLayerItem(i,s);r.appendChild(o)}),t.appendChild(r),t}_createToggleItem(t,e){const r=document.createElement("input");r.type="checkbox",r.className="layer-manager-checkbox",r.checked=!!e.value,r.onchange=s=>{const o={...e};e.value=s.target.checked,this.onChange(this.feature,t,o,e)};const i=document.createElement("label");return i.className="layer-manager-label",i.textContent=e.label||"Unnamed Layer",i.onclick=()=>r.click(),[r,i]}_createSelectUI(t,e){const r=(e==null?void 0:e.mode)??"buttons";let i;if(r==="dropdown"){const a=document.createElement("select");a.className="layer-manager-select",e.options.forEach((l,u)=>{var f;const c=document.createElement("option");c.value=String(l),c.textContent=((f=e.labels)==null?void 0:f[u])??String(l),l===e.value&&(c.selected=!0),a.appendChild(c)}),a.onchange=l=>{const u={...e};e.value=l.target.value,this.onChange(this.feature,t,u,e)},i=a}else{const a=document.createElement("div");a.className="layer-manager-radio-group",e.options.forEach((l,u)=>{var d;const c=document.createElement("label");c.className="layer-manager-radio-label";const f=document.createElement("input");f.type="radio",f.name=t,f.value=String(l),f.checked=l===e.value,f.onchange=y=>{const w={...e};e.value=y.target.value,this.onChange(this.feature,t,w,e)};const p=document.createElement("span");p.textContent=((d=e.labels)==null?void 0:d[u])??String(l),c.append(f,p),a.appendChild(c)}),i=a}const s=document.createElement("fieldset");s.className="layer-manager-fieldset";const o=document.createElement("legend");return o.className="layer-manager-legend",o.textContent=e.label||t,s.append(o,i),[s]}_createLayerItem(t,e){const r=document.createElement("div");if(r.className="layer-manager-item",e.type==="toggle")r.append(...this._createToggleItem(t,e));else if(e.type==="select")r.append(...this._createSelectUI(t,e));else{const i=document.createElement("div");i.textContent=`Unsupported type: ${e.type}`,r.append(i)}return r}_updateButtonLayout(){if(!this.map||!this.container)return;const t=this.map.getContainer(),e=t?t.clientWidth:-1;Tn(this.getPosition(),e)}_refreshUI(){if(!this.container||!this.panel)return;const t=this.buttons.get("layer-manager-toggle");t&&(t.title=`${this.feature} Layers Settings`);const e=this.panel.querySelector(".layer-manager-section");e&&e.remove();const r=this._createLayersSection();this.panel.appendChild(r),this._updateButtonLayout()}updateFeature(t,e){this.feature=t,e&&(this.featureConfigGroups=e),this.layerConfigs=this.featureConfigGroups[this.feature]||{},this._refreshUI()}}T.ColorBar=ci,T.ConfigManager=pi,T.MsgCtl=fi,T.TemporalControl=Dn,T.ToggleCtl=hi,Object.defineProperty(T,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.cjs.map
