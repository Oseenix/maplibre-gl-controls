var l=Object.defineProperty;var u=(a,t,i)=>t in a?l(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i;var o=(a,t,i)=>u(a,typeof t!="symbol"?t+"":t,i);import{a as d,c as p,b as g,d as f,e as m,T as h,r as b,u as I}from"./ui-soYmBaSG.js";class C{constructor(t){o(this,"map");o(this,"container");o(this,"options");o(this,"defaultActiveId");o(this,"activeButtonId",null);o(this,"buttons",new Map);o(this,"instanceId");o(this,"listeners",{toggle:new Set,untoggle:new Set});this.options=t,this.instanceId=this.generateInstanceId(),this.container=this.createContainer(),this.defaultActiveId=this.options.defaultActive}generateInstanceId(){return`togglectl-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}on(t,i){this.listeners[t].add(i)}off(t,i){this.listeners[t].delete(i)}emit(t){for(const i of this.listeners[t])try{i(this)}catch(n){console.error(`[ToggleCtl] error in ${t} listener`,n)}}createContainer(){const t=document.createElement("div");return t.id=this.instanceId,d(t),this.options.buttons.forEach(i=>{const n=this.createButton(i);t.appendChild(n),this.buttons.set(i.id,n)}),this.updateLayout(),t}updateInnerContainerStyle(){if(!this.map)return;const t=this.map.getContainer(),{marginTop:i,marginBottom:n,marginLeft:e,marginRight:s}=p(t,this.getPosition());this.container.style.marginTop=`${i}px`,this.container.style.marginBottom=`${n}px`,this.container.style.marginLeft=`${e}px`,this.container.style.marginRight=`${s}px`,this.container.style.alignItems="flex-start",this.container.style.display="flex",this.updateLayout()}updateLayout(){if(!this.map)return;const i=this.map.getContainer().clientWidth;g(this.getPosition(),i)}createButton(t){return f({icon:m(t.svg,t.label),label:t.label,onClick:()=>this.handleButtonClick(t)})}handleButtonClick(t){if(this.activeButtonId===t.id&&!t.repeat)return;const i=this.activeButtonId;if(t.repeat||(this.activeButtonId=t.id),i&&i!==this.activeButtonId&&this.map){const n=this.options.buttons.find(e=>e.id===i);n&&this.options.onUntoggle&&(this.options.onUntoggle(this,this.map,n),this.emit("untoggle"))}this.buttons.forEach((n,e)=>{e===this.activeButtonId?n.style.backgroundColor=h.color.activeBackground:n.style.backgroundColor=h.color.background}),this.map&&this.options.onToggle&&(this.options.onToggle(this,this.map,t),this.emit("toggle"))}onAdd(t){if(this.map=t,this.map.on("resize",()=>{this.updateInnerContainerStyle()}),this.map.on("styledata",()=>{this.updateInnerContainerStyle()}),this.options.buttons.forEach(i=>{i.setup&&i.setup(this,this.map)}),this.options.buttons.length>0&&!this.activeButtonId){const i=this.options.buttons.find(n=>n.id===this.defaultActiveId);this.handleButtonClick(i||this.options.buttons[0])}return b(this.getPosition(),this.buttons),this.container}onRemove(){var t;I(this.getPosition(),this.buttons),this.map&&(this.map.off("resize",this.updateInnerContainerStyle),this.map.off("styledata",this.updateInnerContainerStyle)),this.options.buttons.forEach(i=>{i.cleanup&&i.cleanup(this,this.map)}),(t=this.container.parentNode)==null||t.removeChild(this.container),this.map=void 0}getPosition(){var t;return((t=this.options)==null?void 0:t.position)||"top-right"}getInstanceId(){return this.instanceId}setActiveButton(t){const i=this.options.buttons.find(n=>n.id===t);i&&this.handleButtonClick(i)}getActiveButton(){const t=this.activeButtonId||this.defaultActiveId,i=this.options.buttons.find(n=>n.id===t);return i||this.options.buttons[0]}updateButton(t,i){const n=this.buttons.get(t),e=this.options.buttons.find(c=>c.id===t);if(!n||!e)return;Object.assign(e,i);const s=n.querySelector("img");s&&(i.svg&&(s.src=`data:image/svg+xml,${encodeURIComponent(i.svg)}`),i.label&&(s.alt=i.label));const r=n.querySelector("span");r&&i.label&&(r.textContent=i.label),this.updateLayout()}updateButtonCallback(t){t.forEach(i=>{const n=i.id||"",e=this.buttons.get(n),s=this.options.buttons.find(r=>r.id===n);!e||!s||Object.assign(s,i)})}}export{C as T};
