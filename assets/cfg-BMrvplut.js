var f=Object.defineProperty;var C=(p,t,e)=>t in p?f(p,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[t]=e;var s=(p,t,e)=>C(p,typeof t!="symbol"?t+"":t,e);import{a as v,f as b,r as _,u as L,g as E,c as S,d as N,h as x,b as P}from"./ui-soYmBaSG.js";import"./cfg-B2Q4qmdK.js";class k{constructor(t={}){s(this,"map",null);s(this,"container",null);s(this,"panel",null);s(this,"buttons",new Map);s(this,"feature","wave");s(this,"position");s(this,"collapsed",!1);s(this,"featureConfigGroups");s(this,"layerConfigs");s(this,"onChange");this.position=t.position||"top-right",this.collapsed=t.collapsed||!0,this.featureConfigGroups=t.featureConfigs||{},this.feature=t.feature||"wave",this.layerConfigs=this.featureConfigGroups[this.feature]||{},this.onChange=t.onChange||((e,n,a,i)=>{console.log("Layer config changed:",e,n,a,i)})}onAdd(t){this.map=t,this.container=document.createElement("div"),v(this.container,{classNames:["layer-manager"]}),this.panel=document.createElement("div"),this.panel.className="layer-manager-panel",this.collapsed&&(this.panel.style.display="none");const e=this._createHeader(),n=this._createLayersSection();return this.container.appendChild(e),this.panel.appendChild(n),this.container.appendChild(this.panel),b(this.container),_(this.getPosition(),this.buttons),this.map.on("resize",()=>{this._updateContainerPosition()}),this.map.on("styledata",()=>{this._updateContainerPosition()}),this.container}onRemove(){this.map&&(this.map.off("resize",this._updateContainerPosition),this.map.off("styledata",this._updateContainerPosition)),L(this.getPosition(),this.buttons),this.container&&E(this.container),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.map=null}_updateContainerPosition(){if(!this.map||!this.container)return;const t=this.map.getContainer(),{marginTop:e,marginBottom:n,marginLeft:a,marginRight:i}=S(t,this.getPosition());this.container.style.marginTop=`${e}px`,this.container.style.marginBottom=`${n}px`,this.container.style.marginLeft=`${a}px`,this.container.style.marginRight=`${i}px`,this._updateButtonLayout()}getPosition(){return this.position}_createLayersIcon(t=20){return`
      <svg
        width="${t}"
        height="${t}"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        style="vertical-align: middle; margin-right: 6px;"
      >
        <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
        <polyline points="2 17 12 22 22 17"></polyline>
        <polyline points="2 12 12 17 22 12"></polyline>
      </svg>
    `}_createHeader(){var n;const t=document.createElement("div");t.className="layer-manager-header",(n=this.position)!=null&&n.includes("left")?t.classList.add("left"):t.classList.add("right");const e=N({icon:this._createLayersIcon(20),label:"Layers Setting",title:`${this.feature} Layers Settings`,onClick:()=>this._togglePanel(),className:"layer-manager-toggle"});return this.buttons.set("layer-manager-toggle",e),t.appendChild(e),t}_togglePanel(){this.panel&&(this.panel.style.display==="none"?(this.panel.style.display="",this.collapsed=!1):(this.panel.style.display="none",this.collapsed=!0))}_createLayersSection(){const t=document.createElement("div");t.className="layer-manager-section";const e=document.createElement("div");e.className="layer-manager-title",e.innerHTML=`<span style="vertical-align: middle;">${x(this.feature)} Layers</span>`,t.appendChild(e);const n=document.createElement("div");return n.className="layer-manager-list",Object.entries(this.layerConfigs).forEach(([a,i])=>{const h=this._createLayerItem(a,i);n.appendChild(h)}),t.appendChild(n),t}_createToggleItem(t,e){const n=document.createElement("input");n.type="checkbox",n.className="layer-manager-checkbox",n.checked=!!e.value,n.onchange=i=>{const h={...e};e.value=i.target.checked,this.onChange(this.feature,t,h,e)};const a=document.createElement("label");return a.className="layer-manager-label",a.textContent=e.label||"Unnamed Layer",a.onclick=()=>n.click(),[n,a]}_createSelectUI(t,e){const n=(e==null?void 0:e.mode)??"buttons";let a;if(n==="dropdown"){const l=document.createElement("select");l.className="layer-manager-select",e.options.forEach((o,d)=>{var r;const c=document.createElement("option");c.value=String(o),c.textContent=((r=e.labels)==null?void 0:r[d])??String(o),o===e.value&&(c.selected=!0),l.appendChild(c)}),l.onchange=o=>{const d={...e};e.value=o.target.value,this.onChange(this.feature,t,d,e)},a=l}else{const l=document.createElement("div");l.className="layer-manager-radio-group",e.options.forEach((o,d)=>{var u;const c=document.createElement("label");c.className="layer-manager-radio-label";const r=document.createElement("input");r.type="radio",r.name=t,r.value=String(o),r.checked=o===e.value,r.onchange=g=>{const y={...e};e.value=g.target.value,this.onChange(this.feature,t,y,e)};const m=document.createElement("span");m.textContent=((u=e.labels)==null?void 0:u[d])??String(o),c.append(r,m),l.appendChild(c)}),a=l}const i=document.createElement("fieldset");i.className="layer-manager-fieldset";const h=document.createElement("legend");return h.className="layer-manager-legend",h.textContent=e.label||t,i.append(h,a),[i]}_createLayerItem(t,e){const n=document.createElement("div");if(n.className="layer-manager-item",e.type==="toggle")n.append(...this._createToggleItem(t,e));else if(e.type==="select")n.append(...this._createSelectUI(t,e));else{const a=document.createElement("div");a.textContent=`Unsupported type: ${e.type}`,n.append(a)}return n}_updateButtonLayout(){if(!this.map||!this.container)return;const t=this.map.getContainer(),e=t?t.clientWidth:-1;P(this.getPosition(),e)}_refreshUI(){if(!this.container||!this.panel)return;const t=this.buttons.get("layer-manager-toggle");t&&(t.title=`${this.feature} Layers Settings`);const e=this.panel.querySelector(".layer-manager-section");e&&e.remove();const n=this._createLayersSection();this.panel.appendChild(n),this._updateButtonLayout()}updateFeature(t,e){this.feature=t,e&&(this.featureConfigGroups=e),this.layerConfigs=this.featureConfigGroups[this.feature]||{},this._refreshUI()}}export{k as C};
