var u=Object.defineProperty;var m=(c,e,t)=>e in c?u(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var h=(c,e,t)=>m(c,typeof e!="symbol"?e+"":e,t);const g=(c,e)=>{const t=document.createElement("img");return t.src=`data:image/svg+xml,${encodeURIComponent(c)}`,t.alt=e,t.style.width="20px",t.style.height="20px",t.style.color="white",t};class y{constructor(e){h(this,"map");h(this,"container");h(this,"outContainer");h(this,"options");h(this,"defaultActiveId");h(this,"activeButtonId",null);h(this,"buttons",new Map);this.options=e;const{outContainer:t,container:n}=this.createContainer();this.outContainer=t,this.container=n,this.defaultActiveId=this.options.defaultActive}createContainer(){const e=document.createElement("div");e.classList.add("maplibregl-ctrl"),e.style.height="100%",e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center",e.style.backgroundColor="transparent";const t=document.createElement("div");return t.classList.add("maplibregl-ctrl","maplibregl-ctrl-group"),t.style.backgroundColor="transparent",t.style.padding="5px",t.style.border="transparent",t.style.boxShadow="none",t.style.borderRadius="4px",t.style.display="flex",t.style.flexDirection="column",t.style.gap="4px",this.options.buttons.forEach(n=>{const i=this.createButton(n);t.appendChild(i),this.buttons.set(n.id,i)}),this.container=t,this.updateLayout(),e.appendChild(this.container),{outContainer:e,container:t}}updateInnerContainerStyle(){var o;if(!this.map)return;const e=this.map.getContainer(),t=e.offsetWidth,n=e.offsetHeight;this.outContainer.style.height=`${n}px`;let i=10,s=10,a=Math.max(10,parseFloat(getComputedStyle(e).getPropertyValue("env(safe-area-inset-left)")||"0")),r=Math.max(10,parseFloat(getComputedStyle(e).getPropertyValue("env(safe-area-inset-right)")||"0")),l=a,d=r;t>=480&&(i=15,s=15,l=Math.max(15,a),d=Math.max(15,r)),n>=992&&(i=40,s=40),t>=992&&(l=Math.max(40,a),d=Math.max(40,r)),(o=this.options.position)!=null&&o.endsWith("left")?(this.container.style.marginLeft=`${l}px`,this.container.style.marginRight=`${r}px`):(this.container.style.marginLeft=`${a}px`,this.container.style.marginRight=`${d}px`),this.container.style.marginTop=`${i}px`,this.container.style.marginBottom=`${s}px`,this.container.style.alignItems="flex-start",this.container.style.display="flex",this.updateLayout()}updateLayout(){if(!this.map)return;const n=this.map.getContainer().clientWidth<768;this.buttons.forEach(o=>{const p=o.querySelector("span");p&&(p.style.display=n?"none":"inline"),o.style.width="fit-content"});const i=Array.from(this.buttons.values()),s=Math.max(...i.map(o=>o.offsetWidth)),a=n?"34px":`${s}px`,r=12,l=i.map(o=>{if(o.style.width=a,n)return null;const p=o.querySelector("span");return!p||!p.textContent?null:[p,this.calculateFontSize(s,p.textContent)]}).filter(o=>!!o),d=Math.min(r,...l.map(([,o])=>o));l.forEach(([o])=>{o.style.fontSize=`${d}px`})}calculateFontSize(e,t,n=12,i=6){const s=e-20-12-4,a=t.replace(/<[^>]+>/g,"").length;if(a===0)return;let l=Math.floor(s/(a*.5));return l=Math.min(n,Math.max(i,l)),l}createButton(e){const t=document.createElement("button");t.style.display="flex",t.style.alignItems="center",t.style.gap="4px",t.style.padding="4px 6px",t.style.border="none",t.style.cursor="pointer",t.style.borderRadius="4px",t.style.width="fit-content",t.style.color="white",t.style.backgroundColor="rgba(0, 36, 71, 0.6)";const n=g(e.svg,e.label);t.appendChild(n);const i=document.createElement("span");return i.textContent=e.label,i.style.fontSize="10px",i.style.color="inherit",t.appendChild(i),t.onclick=()=>this.handleButtonClick(e),t}handleButtonClick(e){if(this.activeButtonId===e.id&&!e.repeat)return;const t=this.activeButtonId;if(e.repeat||(this.activeButtonId=e.id),t&&t!==this.activeButtonId&&this.map){const n=this.options.buttons.find(i=>i.id===t);n&&this.options.onUntoggle&&this.options.onUntoggle(this,this.map,n)}this.buttons.forEach((n,i)=>{i===this.activeButtonId?n.style.backgroundColor="rgba(0, 36, 71, 0.98)":n.style.backgroundColor="rgba(0, 36, 71, 0.6)"}),this.map&&this.options.onToggle&&this.options.onToggle(this,this.map,e)}onAdd(e){if(this.map=e,this.map.on("resize",()=>{this.updateInnerContainerStyle()}),this.map.on("styledata",()=>{this.updateInnerContainerStyle()}),this.options.buttons.forEach(t=>{t.setup&&t.setup(this,this.map)}),this.options.buttons.length>0&&!this.activeButtonId){const t=this.options.buttons.find(n=>n.id===this.defaultActiveId);this.handleButtonClick(t||this.options.buttons[0])}return this.container}onRemove(){var e;this.map&&(this.map.off("resize",this.updateInnerContainerStyle),this.map.off("styledata",this.updateInnerContainerStyle)),this.options.buttons.forEach(t=>{t.cleanup&&t.cleanup(this,this.map)}),(e=this.container.parentNode)==null||e.removeChild(this.container),this.map=void 0}getDefaultPosition(){return"top-right"}setActiveButton(e){const t=this.options.buttons.find(n=>n.id===e);t&&this.handleButtonClick(t)}getActiveButton(){const e=this.activeButtonId||this.defaultActiveId,t=this.options.buttons.find(n=>n.id===e);return t||this.options.buttons[0]}updateButton(e,t){const n=this.buttons.get(e),i=this.options.buttons.find(r=>r.id===e);if(!n||!i)return;Object.assign(i,t);const s=n.querySelector("img");s&&(t.svg&&(s.src=`data:image/svg+xml,${encodeURIComponent(t.svg)}`),t.label&&(s.alt=t.label));const a=n.querySelector("span");a&&t.label&&(a.textContent=t.label),this.updateLayout()}updateButtonCallback(e){e.forEach(t=>{const n=t.id||"",i=this.buttons.get(n),s=this.options.buttons.find(a=>a.id===n);!i||!s||Object.assign(s,t)})}}export{y as T};
