var c=Object.defineProperty;var u=(o,t,i)=>t in o?c(o,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[t]=i;var s=(o,t,i)=>u(o,typeof t!="symbol"?t+"":t,i);import{a as p,b as d,c as g,d as f,e as b,T as h,r as m,u as y}from"./ui-BYb2tV79.js";class v{constructor(t){s(this,"map");s(this,"container");s(this,"options");s(this,"defaultActiveId");s(this,"activeButtonId",null);s(this,"buttons",new Map);s(this,"instanceId");s(this,"listeners",{toggle:new Set,untoggle:new Set});this.options=t,this.instanceId=this.generateInstanceId(),this.container=this.createContainer(),this.defaultActiveId=this.options.defaultActive}generateInstanceId(){return`togglectl-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}on(t,i){this.listeners[t].add(i)}off(t,i){this.listeners[t].delete(i)}emit(t){for(const i of this.listeners[t])try{i(this)}catch(n){console.error(`[ToggleCtl] error in ${t} listener`,n)}}createContainer(){const t=document.createElement("div");return t.id=this.instanceId,p(t),this.options.innerClassName&&t.classList.add(this.options.innerClassName),this.options.width&&(t.style.width=this.options.width),this.options.height&&(t.style.height=this.options.height),this.options.style&&Object.assign(t.style,this.options.style),this.options.buttons.forEach(i=>{const n=this.createButton(i);t.appendChild(n),this.buttons.set(i.id,n)}),this.updateLayout(),t}updateInnerContainerStyle(){if(!this.map)return;const t=this.map.getContainer(),i=this.getPosition();d(this.container,t,i,this.options.style),this.container.style.alignItems="flex-start",this.container.style.display="flex",this.updateLayout()}updateLayout(){if(!this.map)return;const i=this.map.getContainer().clientWidth;g(this.getPosition(),i)}createButton(t){return f({icon:b(t.svg,t.label),label:t.label,onClick:()=>this.handleButtonClick(t)})}handleButtonClick(t){if(this.activeButtonId===t.id&&!t.repeat)return;const i=this.activeButtonId;if(t.repeat||(this.activeButtonId=t.id),i&&i!==this.activeButtonId&&this.map){const n=this.options.buttons.find(e=>e.id===i);n&&this.options.onUntoggle&&(this.options.onUntoggle(this,this.map,n),this.emit("untoggle"))}this.buttons.forEach((n,e)=>{e===this.activeButtonId?n.style.backgroundColor=h.color.activeBackground:n.style.backgroundColor=h.color.background}),this.map&&this.options.onToggle&&(this.options.onToggle(this,this.map,t),this.emit("toggle"))}onAdd(t){if(this.map=t,this.map.on("resize",()=>{this.updateInnerContainerStyle()}),this.map.on("styledata",()=>{this.updateInnerContainerStyle()}),this.options.buttons.forEach(i=>{i.setup&&i.setup(this,this.map)}),this.options.buttons.length>0&&!this.activeButtonId){const i=this.options.buttons.find(n=>n.id===this.defaultActiveId);this.handleButtonClick(i||this.options.buttons[0])}return m(this.getPosition(),this.buttons),this.container}onRemove(){var t;y(this.getPosition(),this.buttons),this.map&&(this.map.off("resize",this.updateInnerContainerStyle),this.map.off("styledata",this.updateInnerContainerStyle)),this.options.buttons.forEach(i=>{i.cleanup&&i.cleanup(this,this.map)}),(t=this.container.parentNode)==null||t.removeChild(this.container),this.map=void 0}getPosition(){var t;return((t=this.options)==null?void 0:t.position)||"top-right"}getInstanceId(){return this.instanceId}setActiveButton(t){const i=this.options.buttons.find(n=>n.id===t);i&&this.handleButtonClick(i)}getActiveButton(){const t=this.activeButtonId||this.defaultActiveId,i=this.options.buttons.find(n=>n.id===t);return i||this.options.buttons[0]}updateButton(t,i){const n=this.buttons.get(t),e=this.options.buttons.find(l=>l.id===t);if(!n||!e)return;Object.assign(e,i);const a=n.querySelector("img");a&&(i.svg&&(a.src=`data:image/svg+xml,${encodeURIComponent(i.svg)}`),i.label&&(a.alt=i.label));const r=n.querySelector("span");r&&i.label&&(r.textContent=i.label),this.updateLayout()}updateButtonCallback(t){t.forEach(i=>{const n=i.id||"",e=this.buttons.get(n),a=this.options.buttons.find(r=>r.id===n);!e||!a||Object.assign(a,i)})}updateStyle(t){this.container&&Object.assign(this.container.style,t)}}export{v as T};
